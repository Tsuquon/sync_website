throughout their daily lives, animals and humans often switch between different behaviours. however, neuroscience research typically studies the brain while the animal is performing one behavioural task at a time, and little is known about how brain circuits represent switches between different behaviours. here we tested this question using an ethological setting: two bats flew together in a long 135 m tunnel, and switched between navigation when flying alone (solo) and collision avoidance as they flew past each other (cross-over). bats increased their echolocation click rate before each cross-over, indicating attention to the other bat1,2,3,4,5,6,7,8,9. hippocampal ca1 neurons represented the bat’s own position when flying alone (place coding10,11,12,13,14). notably, during cross-overs, neurons switched rapidly to jointly represent the interbat distance by self-position. this neuronal switch was very fast—as fast as 100 ms—which could be revealed owing to the very rapid natural behavioural switch. the neuronal switch correlated with the attention signal, as indexed by echolocation. interestingly, the different place fields of the same neuron often exhibited very different tuning to interbat distance, creating a complex non-separable coding of position by distance. theoretical analysis showed that this complex representation yields more efficient coding. overall, our results suggest that during dynamic natural behaviour, hippocampal neurons can rapidly switch their core computation to represent the relevant behavioural variables, supporting behavioural flexibility.the real world is ever dynamically changing, requiring humans and other animals to rapidly switch between different behavioural modes. for example, when a wild rodent is foraging for food, it occasionally needs to avoid predators and decide towards which burrow to escape, therefore switching dynamically between foraging, predator avoidance and decision-making. however, the neural basis of behaviour is typically studied while the animal is performing one behavioural task at a time, and little is known about how brain circuits rapidly switch between different natural behaviours. navigation is a complex, dynamic natural behaviour that enables the testing of behavioural switches. it requires the animal to know its own location within the environment, while also paying attention to abrupt events—such as the appearance of unexpected obstacles, predators or conspecifics; the animal may therefore also need to assess the distance to ‘things out there’. the animal’s position is encoded by hippocampal place cells10,11,12,13; however, this coding has been studied mostly in empty, stationary set-ups that do not imitate the rich dynamism of real-world navigation. there have also been a number of studies that investigated the representation of ‘things out there’ by neurons in the hippocampal formation and surrounding structures15,16,17,18,19,20,21,22,23, but these were all studied under static conditions, without examining dynamic behavioural switches. here we set out to investigate how brief natural attentional switches to ‘things out there’, which are essential for real-life navigation, affect the representation of space in the hippocampus during navigation. we aimed to test several hypotheses regarding how hippocampal circuits may encode position and distance to ‘things out there’ during dynamic navigation: (1) hippocampal activity always encodes only position; (2) hippocampal activity switches between pure position and pure distance representations; (3) hippocampal activity always multiplexes position and distance information; (4) hippocampal activity switches from a position code to a conjunctive representation of distance by position upon a behavioural need. as we show below, our results are most consistent with hypothesis 4.we trained pairs of egyptian fruit bats to fly together in a long 135 m linear tunnel between two landing balls, where food was given. the bats alternated between two behavioural modes (methods): (1) solo: only one bat flew alone, or was >40 m away from the other bat (fig. 1a (left)); or (2) cross-over: the two bats flew towards each other from opposite directions at <40 m (fig. 1a (right)). the bats took off from the balls non-synchronously at random timing relative to each other, creating intermingled solo and cross-over flights, which were distributed approximately uniformly along the tunnel (fig. 1b,c and extended data fig. 1). during cross-overs, the bats bypassed each other at a very high relative speed of around 14 m s−1 (the sum of both bats’ speeds; the speeds of individual bats are shown in extended data table 1) and, therefore, had to be attentive to avoid collision between one another. to measure the bats’ attention, we recorded their echolocation clicks (sonar signals), because many bat species have been shown to increase echolocation click rate when attention is needed; thus, echolocation provides an index of the bat’s moment-to-moment attention1,2,3,4,5,6,7,8,9. indeed, we found that, during cross-overs, the bats increased their echolocation click rate by around fourfold and click amplitude by around twofold (fig. 1d,e and extended data fig. 2c), with this echolocation profile being uniform along the entire tunnel (fig. 1f and extended data fig. 2d). in all of the bats, the increase was rapid (about 1 s), and constituted a switch between two distinct behavioural phases (extended data fig. 2b). this increase in click rate suggests that the bats were highly attentive during these demanding cross-over flights. in the rare cases of near collisions, the bats exhibited fewer echolocation clicks (extended data fig. 2e–g), suggesting that a low click rate indicates a lapse of attention, which may lead to collisions. this provides further support for the link between echolocation rate and attention.a, the experimental set-up. bats flew in pairs and alternated between two behavioural modes: solo (left) and cross-over (right). b, example behaviour (4 min of the full session that is shown in extended data fig. 1a). the blue and orange lines show the positions of the recorded bat and the other bat, respectively; the pink circles show cross-over events; pink rectangles show cross-over flights (±40 m distance around cross-over events); grey rectangles show solo flights. c, the distribution of behavioural coverage along the tunnel in an example session: solo (left) and cross-over (right) flight is shown separately for the two flight directions (dir.) (dark and light coloured, stacked). the light grey vertical rectangles show the areas in which cross-overs were not analysed (methods). d, echolocation example. top, the audio signal during one cross-over flight for the recorded bat (blue) and for the other bat (orange) as a function of the interbat distance (negative/positive distances: bats flying towards/away from each other). bottom, raster plot showing the echolocation clicks of the recorded bat (blue dots) for the 50 cross-overs in this session (one flight direction). note that egyptian fruit bats emit pairs of clicks5. snr, signal-to-noise ratio. e, the population average echolocation click rate (left) and click amplitude (right) for bat 2299 (n = 11 sessions) during cross-over flight (data are mean ± s.d. (pink shading), with the s.d. computed over all behavioural data in each distance bin) and solo flight (data are mean ± s.d.). scale bar, the mean distance flown in 1 s. f, 2d click rate maps for interbat distance (x axis) by position (y axis) for the two flight directions for all sessions of bat 2299, coloured from zero (blue) to peak click rate (red; value indicated). note that the click rate increased before cross-over, similarly along all of the positions (see the vertical band).source datathe use of a very large environment enabled us to examine these fast behavioural switches, because (1) bats fly very fast in large environments, allowing for very rapid switches; (2) the large space allowed for a substantial baseline before and after the cross-overs; and (3) it allowed the bats to perform cross-overs at multiple positions, therefore enabling us to disentangle distance from position. we used a wireless electrophysiology device to record the activity of 430 neurons from dorsal hippocampal area ca1 of four bats during flight (extended data fig. 3a,b and extended data table 1; 389 putative pyramidal cells, 41 putative interneurons; we analysed the data separately for the two flight directions: 693 valid pyramidal cells × directions, 74 valid interneurons × directions; methods). on the basis of the solo flights, we classified 88.5% of the pyramidal cells as significant place cells (n = 613 cells × directions exhibited significant positional modulation of firing rate). place cells exhibited multiple place fields in this long track (mean ± s.d., 3.03 ± 1.81 place fields per direction), with variable field sizes (extended data fig. 3c–g), consistent with our previous report14.during cross-overs, a subpopulation of hippocampal neurons showed significant modulation of their firing rate at specific interbat distances, exhibiting either enhanced or suppressed firing (fig. 2a). we started by analysing the one-dimensional (1d) tuning to interbat distance, irrespective of position along the tunnel: 18.0% of the pyramidal neurons and 39.2% of the interneurons were classified as significantly tuned to distance (pyramidal, n = 125 cells × directions; interneurons, n = 29 cells × directions; fig. 2b–d and extended data fig. 4a); we refer to cells showing 1d distance modulation as 1d distance cells. this classification was based on three main criteria: (1) rigid spike shuffling for cross-over flights, which preserves the spiking pattern but dissociates it from behaviour; (2) shuffling compared to firing expected from solo flights to account for the place tuning (extended data fig. 5); and (3) stability of the distance tuning (extended data fig. 4b and methods). these criteria ensured the detection of significant and stable distance tuning that did not result from the place tuning. the distance modulation was very prominent (extended data fig. 4c; mean z-scored peak enhancement compared with the firing expected from solo: z = 7.18 (pyramidal cells) and z = 7.17 (interneurons)). the distance tuning could not be explained by speed changes during cross-overs (extended data fig. 6), nor by direct responses to individual echolocation clicks (extended data fig. 7a–d). moreover, the distance tuning did not reflect coding of the absolute position of the other bat but, rather, reflected genuine coding of the interbat distance (extended data fig. 8f (right)). in fact, almost no neurons showed significant tuning to the other bat’s position in this behavioural paradigm (extended data fig. 8a; 1.2% of the cells were significant at a 1% significance level: binomial test, p = 0.34). the finding that hippocampal neurons encode distance information during cross-overs rules out hypothesis 1, which suggested that there is only pure position coding in the hippocampus.a, examples of 1d distance neurons. nco represents the number of cross-overs. for each cell, the top row shows the tuning curve for 1d distance (pink line) and shuffles (shading). horizontal lines denote significant enhancement (green) or suppression (brown). in the middle row, the left plot shows the recorded bat position (y axis) and interbat distance (x axis) during cross-overs (grey; the two flight directions yield positive versus negative slopes of the grey lines), with spikes overlaid (pink dots); the centre plot shows the spike raster during solo flights (grey, behaviour; black dots, spikes), showing position (y axis) versus time in the session (x axis; the solo raster has holes in which cross-overs occurred; extended data figs. 1d and 3c); and the right plot shows place tuning during solo flights (black) and during cross-over flights (pink). the bottom row shows the 2d firing-rate map of position (y axis) by interbat distance (x axis), coloured from zero (blue) to peak firing rate (red; value indicated). b–d, population summary of all significant 1d distance neurons for putative pyramidal neurons (n = 125) and interneurons (n = 29). b, top, the mean of z-scored distance tuning curves. a raster of z-scored tuning curves is shown separately for pyramidal neurons (middle) and interneurons (bottom), sorted by peak distance. c, top, the fraction of cells with significant distance enhancement, as a function of interbat distance. significantly enhanced and suppressed bins for pyramidal neurons (middle) and interneurons (bottom) are shown. d, top, the distribution of enhancement response onset (the distance at which the tuning crossed 90% of the shuffle distribution). the response onset for pyramidal neurons (middle) and interneurons (bottom) is shown. inset, pyramidal cells sorted by onset distance (separately for enhancement and suppression). e–g, attentional modulation of distance tuning, comparing higher-click-rate flights (purple, high attention) with lower-click-rate flights (pink, low attention). e, example cells: 1d distance tuning curves. f, the average population tuning curves (each cell was normalized to its peak firing rate computed using all flights) for all 1d distance neurons (right) and all cells significantly modulated by click rate (left). g, the peak firing rate (normalized as described in f), for high- and low-click-rate flights (purple and pink), plotted for 1d distance neurons (right; one-tailed t-test: t = 2.47, p = 0.009, n = 37 cells × directions), and neurons that were significantly modulated by click rate (left; one-tailed t-test: t = 6.44, p = 3.72 × 10−5, n = 11). for f and g, data are mean ± s.e.m.source dataacross the population, 1d distance-coding cells showed significant modulation at many interbat distances, with over-representation of cells tuned to short distances (fig. 2b–d; see extended data fig. 4a for individual animals). the response onset of most neurons occurred early: 70.4% of the pyramidal neurons and 93.1% of the interneurons started responding before the cross-over event (fig. 2d; sign test for the enhancement response onset compared to zero distance: pyramidal neurons, p = 1.27 × 10−4, n = 109 cells × directions; interneurons, p = 3.05 × 10−5, n = 16 cells × directions). notably, the neuronal distance signal started at a similar interbat distance as the attention signal, indexed by an increased rate of echolocation clicks (the response onset in fig. 2d starts at approximately −20 m, similar to the initial increase in click rate: fig. 1e) but the neuronal responses ended later—many pyramidal cells were distance tuned also after the cross-over event (interbat distance > 0), when the echolocation click rate had returned to the baseline. this might be explained as follows: (1) while most neurons were ‘switched on’ by attention before the cross-over event, these cells continued firing for some time, and then other neurons became active after cross-over due to network reverberations or neuromodulators. (2) some pyramidal cells with late activity may have been released from inhibition (fig. 2c; the bottom ~20 pyramidal cells show suppression followed by enhancement), which could stem from interneurons being most strongly active before and around the cross-over event (compare pyramidal cells and interneurons in fig. 2b–d (top)). (3) population activity both before and after cross-over could represent neuronal sequences24,25,26, perhaps reflecting memory encoding of the entire cross-over event. (4) finally, it might be behaviourally relevant to represent the distance from the other bat also after the cross-over event because the other bat could perform a u-turn after the cross-over and fly back towards the recorded bat (indeed, we observed such u-turns occasionally in the experiment). furthermore, bats can directly sense the distance to the other bat behind their back using echolocation, which spreads also backwards5,27; or they can estimate the distance to the other bat after cross-over using path integration by relying on the bats’ fixed speed.the distance tuning was generally uncorrelated between the two flight directions (extended data fig. 4h–j) and was also uncorrelated between positive and negative distances (extended data fig. 4k). this suggests that the distance-tuned neurons did not encode absolute distance but, rather, encoded distance and direction. thus, these neurons could be interpreted as vectorial distance cells (other types of vectorial cells in the hippocampal formation were described previously18,19,21,23).to explicitly test whether attention modulates the 1d distance tuning, we performed several analyses. first, we bisected the cross-over flights into those with lower attention versus those with higher attention (lower versus higher click rate), and found that cells with 1d distance tuning exhibited stronger responses during high-attention flights (fig. 2e–g and extended data fig. 7e; bisection was performed for entire cross-over flights; we included here only cells recorded simultaneously with audio; methods). as distance tuning could not be explained by direct responses to echolocation clicks (extended data fig. 7a–d), these results suggest that 1d distance neurons are modulated by high-level cognitive variables, such as attention, arousal or an enhanced state of active sensing.second, to experimentally test the effect of attention, we trained one pair of bats to perform an additional behaviour—tracking—in which the two bats flew in the same direction at a short interbat distance (extended data fig. 9a (cyan and turquoise rectangles) and methods). we reasoned that, as the relative speed during tracking was near-zero (in contrast to cross-over, for which it was around 14 m s−1), tracking requires lower attention than cross-over. indeed, bats echolocated at much lower rates during tracking (extended data fig. 9b), suggesting that tracking requires less attention. during tracking flights, ca1 neurons preserved their place tuning, but did not preserve their distance tuning; in fact, distance tuning was largely absent during tracking (extended data fig. 9). this suggests that only when attention is strongly required—during cross-overs, but not during tracking—ca1 neurons encode the interbat distance.third and finally, in another pair of bats, after the end of the regular behavioural session, we conducted a second session in which the recorded bat flew with an alternative partner bat. we reasoned that, during collision avoidance (cross-over), it is important to attend to the other bat and represent its distance irrespective of the other bat’s identity. indeed, distance tuning was largely preserved between the two sessions with different partners (extended data fig. 10). this suggests that the observed distance tuning (fig. 2) is probably not social but, rather, is related to collision avoidance.next, we considered the 2d tuning of neurons to distance by position. as the vast majority of ca1 pyramidal neurons in the long tunnel were place cells14 (extended data table 1), we started by analysing the distance tuning curve separately within each place field. half of the place fields (49.3%, 301 out of 611) were significantly modulated by the interbat distance, showing enhancement, suppression or both (see fig. 3a and extended data fig. 11a for examples and fig. 3b for the population). interestingly, different place fields of the same neuron could exhibit different distance tuning (fig. 3a (cell 331) and extended data fig. 11a (cell 287)); we return to this issue below. overall, place cells encoded the position of the bat when flying alone but, during cross-overs, they conjunctively encoded distance by position, and then switched back to their position coding after the two bats passed each other (fig. 3a). as the bats flew very fast, these switches between different representations were extremely fast—as fast as 100–200 ms (fig. 3c and extended data fig. 11e).a, examples of three neurons. for each cell, the middle and right plots are as described in fig. 2a, and the left plot shows the 1d distance tuning curves within different place fields (colours correspond to different place fields, marked by vertical coloured lines on the left of the centre plot). place fields here and elsewhere were defined on the basis of solo data. shading shows cross-over shuffles; horizontal green and brown lines show bins with significant enhancement and suppression, respectively. b, the percentages of different types of distance modulation within place fields for neurons with different numbers of place fields. compound modulation indicates tuning with both significant enhancement and suppression (for example, cell 234 (blue) in a). c, the distribution of neuronal switch times of the distance tuning. top, the rise time (dark green) and fall time (light green; stacked) for place fields with significantly enhanced distance tuning curves. n = 143. bottom, the fall time (dark brown) and rise time (light brown) for place fields with significantly suppressed distance tuning curves. n = 62. only a subset of the fields was valid for analysis here (methods). d, examples of two neurons with significant enhancement outside their place fields (within an interfield), plotted as described in a. the vertical lines on the left of the centre panel mark place fields (black) and interfields (peach). the black arrows indicate spikes contributing to distance tuning within the interfield; note that there were barely any spikes in the same position during solo flights (see the solo raster on the right). e, population summary: distance bins that were significantly enhanced (green) or suppressed (brown) within place fields (n = 301 fields) and interfields (n = 59) sorted by distance-tuning peak. f, 2d distance by position tuning: patch analysis. examples of cells with significant 2d patches are plotted as described in fig. 2a without the raw data panels. the outlines show significant 2d patches (enhancement (green); suppression (brown)). the vertical black lines show place fields. g, summary of different functional classes of pyramidal cells (numbers denote cells × directions). place cells are shown in grey. the thick black curve encompasses the total number of distance-modulated cells (n = 384, 55.4% of all pyramidal cells).source datainterestingly, significant distance tuning was also seen outside of place fields, in areas defined as interfields (n = 59 interfields showed significant responses, out of 87 interfields valid for analysis; fig. 3d and extended data fig. 12a (black arrows) and methods). these distance-tuned responses in interfield areas were very strong compared with the low firing rate during solo flights (extended data fig. 12d). this type of distance response might be explained by the presence of subthreshold place fields28, which are enhanced by incoming distance inputs and rendered suprathreshold, therefore creating a distance-by-position response. overall, the distance-tuned place fields and interfields spanned a wide range of distances, with an over-representation of short interbat distances (fig. 3e and extended data figs. 11c and 12c).we further examined the existence of significant 2d distance-by-position modulation of firing rate irrespective of place field definitions. we used cluster analysis (methods) and identified ‘2d patches’ in the 2d distance-by-position firing-rate maps, which were significantly enhanced or suppressed relative to solo (see fig. 3f for examples and extended data fig. 12f for the population; 9.7% of the significant patches occurred outside of place fields; fig. 3f (cell 314) and extended data fig. 12e). when considering collectively cells with 2d distance modulation (neurons with significant patches, or significant tuning within-field or interfield; fig. 3g (purple ellipse)) and cells with 1d distance modulation (fig. 3g (pink ellipse)), the majority of pyramidal cells in ca1 were significantly modulated by the interbat distance during cross-overs (55.4%, n = 384/693 cells × directions; fig. 3g (thick black line)). the existence of 2d distance-by-position patches rules out hypothesis 2—which suggested a switch between pure position coding and pure distance coding—because both signals were conjunctively encoded during cross-overs. in fact, there are two versions of hypothesis 2—(1) separate populations of neurons encode position and distance, or (2) single neurons switch between purely representing position and purely representing distance—and our results ruled out both options.two remaining hypotheses may underlie the results presented so far: hypotheses 3 and 4. hypothesis 3 suggests multiplexing of position and distance information by the neurons—that is, the neurons exhibit 2d distance-by-position tuning, and are continuously ready to process both of these incoming information streams. hypothesis 4 suggests that individual hippocampal neurons exhibit switching from position coding during navigation to conjunctive coding of distance by position during collision-avoidance behaviour. we believe that hypothesis 4, that is, switching, is more probable because we found that (1) during cross-overs, the position tuning changed significantly compared with solo flight (fig. 4a), accompanied by a small but significant decrease in spatial information (fig. 4b); furthermore, there was a substantial increase in the position decoding error at short interbat distances, when we used the solo-based tuning for decoding (fig. 4c). importantly, the changes in the position tuning (fig. 4a–c) could not be explained by changes in the firing rate because there was no prominent change in the average firing rate during cross-overs (fig. 4d). this suggests that the distance information comes partially at the expense of the position tuning, as expected from a switch. (2) the rise time of neuronal responses during cross-over was independent of the flight speed (extended data fig. 6k). this is consistent with a neural switch rather than multiplexing, because flight through a static multiplexed tuning curve of distance by position should have yielded a faster rise time at a higher flight speed, which we did not observe (extended data fig. 6k; t-test: t = 0.84, p = 0.41; n = 120 neurons). by contrast, for a neuronal switch, we expect that the switch time will have a fixed duration irrespective of velocity, consistent with our results. (3) the neuronal modulation was extremely rapid (fig. 3c and extended data fig. 11e), consistent with a neuronal switch. (4) most neurons responded in sync at similar distances (fig. 2b–d), and this was particularly prominent in each animal separately (extended data fig. 4a). (5) these highly visual bats probably see each other from much greater distances than 20 m (refs. 29,30), and yet they exhibited a substantial behavioural and attentional switch at a distance of −20 m (fig. 1d–f), and the neurons mostly started responding at −20 m (fig. 2d), which seems to be more consistent with a switch, or gating of neuronal coding. (6) hippocampal neurons did not always encode distance-by-position information; during tracking, the distance coding was almost absent (extended data fig. 9). this is inconsistent with multiplexing of information, and more consistent with neuronal switching that is based on behavioural and attentional demands. however, in contrast to the switching notion, neurons also exhibited a diversity of preferred distances, consistent with multiplexing of information rather than with a network-level switch. thus, the data are partially consistent with both hypothesis 3 (multiplexing) and hypothesis 4 (neural switching).a–d, change of position tuning during cross-overs. a, the average pearson correlation between position tuning during solo and during cross-over flights, computed in 10-m distance bins (methods). data are mean ± s.e.m. (pink). n = 613 place cells × directions. note the correlations decreased when bats approached each other, indicating a change in position tuning. the grey curve was computed as described for the pink curve, using solo projected on cross-over shuffles. b, spatial information (mean ± s.e.m.; n = 613 place cells × directions) for the position-tuning curves computed during cross-over flights (pink), and for solo projected on cross-over shuffles (grey). c, position decoding error as a function of distance during cross-over (pink; mean ± s.e.m.; n = 16 sessions) and chance level (grey). note the increased decoding error at short distances. d, firing rate (normalized to the peak of each cell) as a function of distance during cross-over for all place cells. data are mean ± s.e.m. n = 613 place cells × directions. e,f, simultaneous decoding of the interbat distance and position during cross-over flights. e, examples of two flights (columns). top, real position (black) and decoded position (blue) versus time. bottom, real and decoded interbat distance. f, confusion matrices (pooled over all sessions with ≥10 cells recorded simultaneously; n = 16 sessions). left, the probability of decoded positions (y axis) for each real position (x axis), normalized to the uniform chance probability pchance = 1/nbins (colour bar). right, the same for the interbat distance. the diagonal structure in these matrices indicates accurate and unbiased decoding. g,h, the decoding error of interbat distance for different click-rate quartiles (q1–q4, quartiles of low click rate to high click rate) for one example session (g) (n = 146, n = 134, n = 146 and n = 151 decoding time windows for q1–q4) or pooled over all nine sessions that had audio recordings and ≥10 cells (h) (n = 998, n = 1,051, n = 1,074 and n = 1,063 decoding time windows for q1–q4). note that the decoding error decreased as the click rate increased (q4, maximal click rate, that is, maximal attention; click rate is a proxy of attention). data are mean ± s.e.m. statistical analysis was performed using analysis of variance with post hoc correction for multiple comparisons: *p < 0.05, **p < 0.01, ***p < 0.001, ****p < 0.0001; no asterisks, not significant. see extended data fig. 13c for the exact p values, violin plots and kruskal–wallis tests.source datanext, we examined whether the distance-by-position representation enables decoding simultaneously the interbat distance and the position of the bat during cross-overs. we were able to simultaneously decode both variables using relatively small cell numbers (fig. 4e,f and extended data fig. 13; n = 10–22 simultaneously recorded cells; methods). the interbat distance was decoded above chance at all ±40 m distances (fig. 4f (right) and extended data fig. 13b), although decoding was better at short interbat distances of ±20 m. interestingly, when dividing the cross-over data to attention levels on the basis of the bat’s echolocation click rate, we found that the distance decoding error decreased as the click rate increased, that is, as the attention increased (fig. 4g,h and extended data fig. 13c,d). this suggests that, on a trial-by-trial basis, hippocampal neurons encode distance information more precisely when the recorded bat is more attentive to the other bat.we next examined in more detail the nature of the conjunctive 2d distance-by-position coding. in many place cells, different place fields of the same neuron were modulated differently by the interbat distance (figs. 3a (cell 331) and 5a). indeed, over the population of place cells, the distance-tuning correlations between place fields of the same neuron were widely distributed around zero (fig. 5b (pink)), and were only marginally different from the across-cell shuffle distribution (fig. 5b (grey); there was a slight over-representation of cells with high correlations; kolmogorov–smirnov test, p = 0.016). consistent with this, the correlation of distance tuning between pairs of place fields was independent of the difference in their positions along the tunnel (fig. 5c (left); pearson r = −0.08, p = 0.31). this lack of correlation between different fields could not be explained by differences in behaviour along the tunnel because (1) both echolocation profiles and flight velocity were nearly constant along the tunnel (fig. 1f and extended data fig. 6c); (2) there was no correlation between the difference (contrast index) of the echolocation click rate within pairs of place fields of the same neuron, and the distance-tuning correlations of these fields (fig. 5d); and (3) simultaneously recorded neurons often showed very different distance tuning at the same position (fig. 5c (right); note the wide distribution of correlations for small position difference between fields), despite the same underlying behaviour. taken together, these results indicate that different place fields of the same neuron exhibited almost independent distance tuning, suggesting a non-separable 2d distance-by-position coding—the 2d coding could not be described by a multiplication of the two 1d marginals, that is, by a multiplication of the tuning curves for distance and for position. this finding may imply modularity, whereby different distance computations are performed at different place fields.a–d, different distance tuning across different place fields. a, example cell. note the two place fields showed opposite distance modulation. b, the distribution of pearson correlations between the 1d distance tuning curves of pairs of place fields of the same cell (pink; n = 170 pairs; the inclusion criteria are described in the methods), or place fields of different simultaneously recorded cells (grey, cell shuffling; n = 2,479 pairs). c, pearson correlations between the 1d distance tuning curves of pairs of place fields of the same cell (left) or of simultaneously recorded different cells (right), plotted versus the position difference between the place-field peaks (pearson correlations of the scatters are indicated). d, pearson correlations between the 1d distance tuning curves of pairs of place fields of the same cell (y axis) and the contrast index of echolocation click rate during cross-over within these pairs of place fields (x axis; contrast index = (crfield1 − crfield2) / (crfield1 + crfield2), where cr is the click rate). n = 79 pairs of place fields recorded with audio. e–g, svd analysis shows non-separable distance-by-position coding. e, example neurons with varying degrees of non-separability. top, 2d firing rate map of position (y axis) by interbat distance (x axis), cropped and completed for the svd analysis (methods); λ and α (non-separability indices) are indicated: higher values denote non-separable cells; neurons are sorted by λ. bottom, histograms of shuffle distributions (grey) and real values (red lines) for λ (left) and α (right). cell 96 is separable (two place fields show same distance tuning), the other five cells are significantly non-separable (different distance modulations at different positions). f, the distributions of λ and α across all cells in the svd analysis (n = 262 cells × directions; inclusion criteria are described in the methods). grey, non-significant cells (n = 189 cells × directions). red, significantly non-separable cells (n = 73 cells × directions). g, non-separability indices λ and α versus the number of place fields of the cell (only place fields within the svd rectangular maps were included; n = 237 place cells × directions). spearman correlation ρ values are indicated. the black dots show the median; and the black lines are kernel density plots. h,i, the functional advantage of non-separability: theoretical analysis of distance decoding for simulated neurons. h, mean decoding error (left) and catastrophic decoding error (right, 99th percentile of errors), plotted on a log scale as a function of the interbat distance, separately for simulated populations of cells with different non-separability values, λ (different colours). grey, chance-level decoding. i, mean decoding error (left, colour-coded) and catastrophic decoding error (right) as a function of the number of neurons used for decoding and the non-separability index, λ.source datato further characterize the non-separability of the 2d distance-by-position coding of ca1 neurons, we performed a singular value decomposition (svd) analysis31,32 (fig. 5e–g, extended data fig. 14 and methods). this standard analysis enables us to determine whether a 2d map is separable (fig. 5e (cell 96)) or is more complex (non-separable cells; fig. 5e (five rightmost cells)). we quantified the non-separability using two svd indices (λ and α, where higher values indicate stronger non-separability; methods), and compared it to shuffles: this revealed that 27.9% of the pyramidal cells tuned to distance were significantly non-separable (fig. 5f). dimensionality analysis showed that some of the non-separable cells required more than four dimensions to describe their 2d distance-by-position maps (extended data fig. 14d,e; mean, 2.25 dimensions), highlighting the complexity of their 2d tuning. this non-separability could not be explained by spike-sorting quality, nor by the very small inhomogeneities in click rate or flight speed (details are provided in the legend of extended data fig. 14) (fig. 1f and extended data fig. 6c). moreover, we found that place cells with a higher number of place fields were more likely to have higher non-separability indices (fig. 5g).although non-separable complex tuning has been found also in other brain areas31,32,33,34,35,36, it remained unclear whether such tuning offers any functional advantage. a previous theoretical study showed that conjunctive 2d representation of two variables is more efficient than two separate 1d representations (by separate neuronal populations), especially when fast computations are needed for the two variables simultaneously37. however, that study did not examine specifically whether a non-separable conjunctive 2d representation is useful. to investigate the possible advantage of such non-separable coding in the hippocampus, we simulated populations of place cells with the same distance modulations but with different degrees of non-separability (extended data fig. 15a). we then decoded the interbat distance from each population, and found that higher levels of non-separability led to lower decoding errors (fig. 5h and extended data fig. 15b,d,f). furthermore, increasing the non-separability of the cells was equivalent to increasing the population size—that is, the same decoding error can be achieved with fewer neurons if their tuning is non-separable (fig. 5i and extended data fig. 15c,e,g). this suggests that the non-separable distance-by-position tuning yields a more efficient encoding of distance.here we studied naturalistic behavioural switches between navigation and collision avoidance in flying bats, and found three key results: (1) more than half of the hippocampal place cells encoded conjunctively distance-by-position information (fig. 3)—switching very rapidly (as fast as 100 ms) from a position representation to a distance-by-position representation (fig. 3c and extended data fig. 11e). crucially, these rapid switches occurred at the level of single neurons. (2) the distance tuning was modulated by the bat’s sonar-guided attention (figs. 2e–g and 4g,h and extended data fig. 13c,d). (3) finally, we found that, for many cells, the distance-by-position tuning was non-separable—an individual neuron could exhibit different distance modulation at different positions along the tunnel; specifically, different place fields of the same neuron exhibited very different distance tuning (figs. 3a and 5). this may suggest modularity of hippocampal processing across different place fields. simulations of a theoretical model showed that such non-separable neuronal code leads to better encoding of distance information (fig. 5h,i). our results are fundamentally distinct from previous reports (for details, see the ‘additional discussion’ section in the methods).we propose that the non-separable code could be formed by independent position and distance inputs arriving to ca1 (extended data fig. 16). specifically, we previously proposed that the multiple place fields of a single ca1 neuron arise from different dendrites receiving independent position inputs14 (extended data fig. 16 (grey); inputs from ca3 or medial entorhinal cortex). here we speculate that there are also independent distance inputs, with a variety of different distance modulation profiles, that arrive at ca1 (for example, from the lateral entorhinal cortex or from the subiculum through the medial entorhinal cortex), as well as inputs that carry attention or context signals (extended data fig. 16). these converging streams are combined in ca1, generating multiple place fields with different distance modulations, similar to what we found experimentally. this model suggests a key computational role for dendrites in generating the complex distance-by-position tuning observed in ca1.overall, our results suggest that, during a natural behavioural switch, the same hippocampal neurons can switch between two different types of neural codes very rapidly and flexibly, reflecting the animal’s behavioural needs. this dynamic view of hippocampal function calls for future dynamic experiments designed to further elucidate how the hippocampus supports flexible natural behaviours.four adult male egyptian fruit bats, rousettus aegyptiacus, were included in this study for electrophysiological recordings (weight, 160–175 g). no randomization or blinding was applied in this study. sample size was not predetermined; the number of animals is standard for studies in this research field. information on the individual bats is summarized in extended data table 1. an additional four bats were used for the behavioural assay as partners. all of the bats in this paper were caught as adults in the wild (in israel). all experimental procedures were approved by the institutional animal care and use committee of the weizmann institute of science.bats flew in pairs (two bats together in each experiment) in a long straight tunnel (135 m × 2.3 m × 2.35 m (length, width, height); fig. 1a). this flight tunnel was part of a longer 200 m tunnel, and the 135 m straight part was blocked by an opaque curtain. the bats flew between two landing balls that were located at the two ends of the tunnel, at a distance of 125 m from each other. on these balls, the bats could rest and receive food. the tunnel was uniformly illuminated (illuminance level: 5 lux). to ensure that the bats were aware of their position, 10 unique landmarks were distributed randomly along the tunnel, and were positioned at fixed locations across all of the experiments.the bats were initially pretrained for ~2 weeks (15–20 min per day) to fly alone between two landing balls in small-scale environments (either a flight room of ~6 × 5 m, or a short ~6 m segment of the flight tunnel), with the aim of getting used to handling by humans, and learning to directly fly between the two landing balls. the bats were then introduced individually to the long tunnel (135 m) with three training aims: first, getting the bats used to the experimental set-up; second, enhancing flight stamina; and third, training them to fly direct flights between the landing balls without performing u-turns. once they reached good flight performance (which took around 1–2 weeks), they were introduced to their partner and flew together in the tunnel for about 1 week before surgery.after training, the bats were implanted with a microdrive for electrophysiological recordings in the dorsal hippocampal area ca1 (see below). each experimental session started and ended with sleep sessions (each sleep session lasting 5–10 min). for the sleep sessions, the bat was placed alone inside a small covered cage which was positioned on the floor in a quiet location inside the tunnel.a pair of bats flew together in the tunnel, performing direct flights between two landing balls. we considered two different behavioural modes (fig. 1a,b and extended data fig. 1): (1) solo flights, in which one bat was flying alone and the other bat was resting, or when the distance between the bats was >40 m. (2) cross-over flights, in which the two bats flew towards each other with an interbat distance of within ±40 m (for more details, see the ‘extracting flights and dividing data to different behavioural modes’ section below). during cross-overs, the bats had to be attentive to avoid collision with the other bat as this is a relatively narrow tunnel and because the bats crossed each other at a very high combined relative speed of around 14 m s−1 (see extended data table 1 for the speeds of individual bats). although collision avoidance is a very natural behaviour for bats, it was by no means trivial—we actually had a few collisions or near-collisions between the bats during training, as well as during the experiments themselves (extended data fig. 2g), emphasizing that the need to pay attention was not hypothetical.the experimenters timed the bats’ take-offs from the two balls at both ends of the tunnel to create a nearly uniform coverage of cross-overs along the tunnel, which was roughly randomly distributed over time (fig. 1c and extended data fig. 1). the experimenters stood near to the landing balls at the two ends of the tunnel, and did not enter the central 125 m behavioural zone. the bats flew in total 13.14 ± 3.50 km per session (mean ± s.d.; the distance per bat is shown in extended data table 1); the behavioural session lasted around 1.5–2 h.for one pair of bats, we had two additional behavioural modes (recorded bat no. 30; extended data table 1). (1) tracking mode: the two bats flew in the same direction with a short interbat distance (one bat tracked the other with an interbat distance of less than ±20 m; extended data fig. 9). (2) obstacle-avoidance mode: in the middle of the session, we introduced a stationary obstacle (vertical pole) inside the tunnel, which the bats had to avoid colliding with. as we decided to focus here on cross-over behaviours with other bats, we removed epochs near to this stationary obstacle for those cells that showed significant modulation by the obstacle (this resulted in the removal of 0.49% of the flight data for the cells recorded with obstacle).in another bat pair, we conducted an additional session in which we switched the partner bat. in the first session, the recorded bat (bat no. 2299) was flying with his usual partner for a full session of 1.5–2 h (session a), then it rested ~40–60 min and we then ran the experiment again with an alternative partner for another ~1 h (session b). the recorded bat was familiar with both the usual partner and the alternative partner before surgery. as this was a very long and physically demanding experiment for the recorded bat (the recorded bat flew 21.85 ± 2.07 km per day in these two sessions together (mean ± s.d.), while carrying the recording-devices on its head), we succeeded to run this two-session experiment for only 3 days. a comparison of neural recordings from these two sessions is shown in extended data fig. 10.the use of a long flight tunnel in our experiment was crucial for several reasons: (1) in such a large-scale set-up, the bats fly very fast, which enabled us to investigate hippocampal neural activity during fast behavioural switches. (2) as we knew that the bats respond to each other at a distance of approximately −20 m before cross-over (fig. 1d,e), and as we wanted to record also baseline activity before that (for comparison), this required defining a large symmetric window of ±40 m as the cross-over flight, which necessitated a large-scale environment. (3) to examine the response to interbat distance irrespective of position, we needed to disentangle distance from position in the experiment, which required having cross-over events at different locations in the tunnel (fig. 1c and extended data fig. 1). this required a long tunnel. (4) as in large-scale environments there are multiple place fields for each place cell14, it enabled us to test whether different place fields of the same neuron exhibit different distance tuning (fig. 5). this would not have been possible in small environments, in which typically only one place field is observed for each place cell14.we tracked the position of the bats using wireless radio-frequency localization tags (weight, 6.6 g, including battery; bespoon), which received and transmitted signals to an array of 14 ground-based antennas that were distributed around the tunnel. a spherical estimation of the tag’s distance from each antenna was computed on the basis of the time interval between the signal transmission and arrival. the position of the bat in 3d was then estimated using the intersection of these spheres from all of the antennas. this localization method yielded a good precision of around 9 cm in the longitudinal and lateral axes of the tunnel14, but the vertical precision was poorer, and we therefore did not use the height measurements for analysis. each bat had his own tag with a unique id; the position of each bat was computed at a sample rate of 12.8 hz or 16 hz. both tags were synchronized to the neural recordings using a non-periodic sequence of ttl pulses (precision of <1 ms).all data in this study were analysed using matlab. location data from the localization system were processed as described in ref. 14. in brief, we first removed outliers (defined as data points that were far away (>2 m) perpendicularly from the tunnel’s midline, or data with unreasonably high speed (>20 m s−1)). we then linearized the data by projecting the valid positional data onto the long 1d axis of the tunnel. we then filled short gaps where data were missing, as described in ref. 14. finally, the positional data were upsampled to 100 hz.we analysed only flight epochs, and excluded data from take-offs and landings: flight epochs were detected based on: (1) speed (>2 m s−1), and (2) distance from the landing balls (>3 m from the balls). in the cases in which the bat performed a u-turn in the middle of the tunnel, we discarded an extra 3 m before and after the u-turn event (beyond the 2 m s−1 speed threshold) to avoid contamination by possible ‘u-turn coding’.we further divided the data to distinct behavioural modes on the basis of the localization data of the two bats and their flight direction:solo flights: the recorded bat was flying while the other bat was resting, or both bats were flying and the interbat distance was >40 m. the 40 m threshold was taken because bats are probably not attentive to the other bat at large distances of >40 m (see the next paragraph), and we therefore considered such large distances as if the bat was flying alone. short solo flights that lasted less than 2 s (corresponding to around 14 m) were discarded from the analysis.cross-overs: the bats flew in opposite directions and passed each other. the cross-over event was defined as the point of interbat distance = 0, with the distance measured along the long axis of the tunnel. as cross-overs are momentary events, we considered a distance-window of ±40 m around each cross-over event, which we defined as a cross-over flight. the bats increased their echolocation rate at distances between −20 m and 0 m (fig. 1d–f and extended data fig. 2), which suggests that they are attending to the other bat at these distances1,2,3,4,5,6,7,8,9,38,39,40,41; to enable the analysis of an extra baseline, we considered a larger and symmetrical distance window of ±40 m, which enabled us to detect neuronal modulations and their return to baseline activity. cross-overs that occurred less than 8 m from the landing balls were excluded from the analysis to avoid effects of landing and take-off (see the light grey vertical rectangles in fig. 1c and extended data fig. 1b,e). furthermore, we excluded cross-over flights in which the two bats did not fly in opposite directions for at least 5 m before and 5 m after the cross-over event. most of the valid cross-over flights were long (median, 80 m, which is also the maximum possible length of a cross-over flight, given our ±40 m analysis window); however, cross-over events that were close to landing balls or u-turns resulted in cross-over flights that were shorter than 80 m (mean cross-over flight length: 74.84 ± 11.36 m (mean ± s.d.); minimal length 20.77 m).tracking: the two bats flew in the same direction with an interbat distance of less than ±20 m. we further divided the tracking epochs to flights in which the recorded bat was following the other bat (interbat distance between −20 m and 0 m) and when the recoded bat was leading (interbat distance between 0 m and 20 m). tracking behaviour was analysed only in bat no. 30, which was trained to perform many tracking flights: these analyses are shown in extended data fig. 9. in all of the other bats we had only a few or no tracking flights during the session, and they were therefore not analysed.in egyptian fruit bats, echolocation consists of pairs of very short ultrasonic clicks5,6. to detect these clicks, we recorded the audio signal using an on-board audio logger with an ultrasonic microphone. as there is a limit to the weight that bats can carry, in most experiments we could not record simultaneously the audio signal (audio logger) together with the neuronal recordings (neural logger) and position (positioning tag). thus, in two bat pairs (recorded bat–partner no.: 2336–2331 and 2389–2387) we recorded the audio signal separately in some of the days instead of recording neuronal data. for bat 30, audio was recorded using a different audio-logger device and therefore its click amplitude was not comparable with the other bats and was not analysed in extended data fig. 2c (the click rate from bat 30 appears only in extended data fig. 9b). in our last bat pair (recorded bat–partner no.: 2299–2331), a new miniature version of the data logger was developed, which enabled us to record simultaneously both the neuronal activity and the audio signal. together, behavioural analyses of the bats’ echolocation were performed on n = 6 bats (extended data figs. 2c and 9b), and analyses combing simultaneously recorded neural data and echolocation data were performed on one bat (bat no. 2299; figs. 2e–g and 4g,h and extended data figs. 7 and 13c,d). for all of the audio recordings, with all devices, audio signals were filtered online (in hardware) between 4–40 khz, and were recorded at a 100 khz sample rate (this frequency range covers most of the energy of the echolocation clicks of this bat species6).detection of echolocation clicks emitted during flight was performed offline as follows: we first further high-pass-filtered the audio signal at 10 khz, as the echolocation clicks of this species do not contain energy below 10 khz6. we then normalized the signal by its mean absolute deviation (mad) over the entire session—transforming the amplitude to a snr. we then used an amplitude threshold of 50 mads (that is, snr = 50), which detected clicks reliably, together with several time-domain criteria on the basis of known properties of the sonar clicks of this bat species6: (1) duration of click of 30–2,500 μs; (2) maximum rise time of 500 μs; and (3) minimum inter-click interval of 10 ms. we also used a frequency criterion, consisting of a minimum energy ratio of 10 db between a high-frequency band (18–40 khz) and a low-frequency band (5–12 khz). as we recorded audio signals from both bats, we could remove clicks originating from the other bat by estimating their expected time-of-arrival to the recorded bat’s microphone using the interbat distance (measured using the localization system) divided by the speed of sound: this enabled us to discard low-amplitude clicks (snr = 50–200) emitted by the other bat, which were detected on the recorded bat’s microphone at these estimated timings ±3 ms (extended data fig. 2a). in the bat with simultaneous audio and neural recordings, we also manually curated the detected clicks to further improve the click detection (1.77% manually added clicks, 0.01% removed clicks).all of the surgical procedures were performed as described previously14. in brief, after completion of training, bats were implanted with either a 4-tetrode microdrive (weight, 2.1 g; neuralynx), or a 16-tetrode microdrive (weight, 3.4 g; modified from ref. 42), loaded with tetrodes, with each tetrode constructed from four strands of insulated wire (17.8 μm diameter platinum-iridium wire). tetrodes were gold-plated to reduce the wire impedance to 0.3 mω (at 1 khz). the microdrive was implanted above the right dorsal hippocampus (3.0–3.6 mm lateral to the midline and 5.8 mm anterior to the transverse sinus that runs between the posterior part of the cortex and the cerebellum); the craniotomy was then covered with an inert silicone elastomer (kwik-sil or kwik-cast). during the implantation surgery, we used an injectable anaesthesia cocktail composed of medetomidine (0.25 mg kg−1), midazolam (2.5 mg kg−1) and fentanyl (0.025 mg kg−1), and added supplemental injections as needed, based on the bat’s breathing and heart-rate43. the microdrive was attached to the skull with bone screws, using a layer of adhesive (super-bond c&b) followed by dental acrylic. we attached the ground wire from the microdrive to a bone-screw that touched the dura in the skull’s frontal plate.after surgery, the tetrodes were slowly lowered towards the ca1 pyramidal layer; positioning of tetrodes in the layer was provisionally performed on the basis of the presence of high-frequency field oscillations (ripples) and associated neuronal firing, and was later verified histologically (extended data fig. 3a). for each bat, one tetrode was left in an electrically quiet zone and served as a reference, and the remaining tetrodes served as recording probes.during recordings, a wireless neural-recording device (neural-logger; 16-channels or 64-channels, deuteron technologies) was attached to a connector on the microdrive. signals from all channels were amplified (×200) and bandpass filtered (1–7,000 hz), and were then sampled continuously at 31.25 or 32 khz per channel, and stored on board the neural-logger. during subsequent processing, the neural recording was further high-pass filtered with a 600 hz cut-off for spikes, creating a spike bandwidth of 600–7,000 hz, and then a voltage threshold was used for extracting 1 ms spike waveforms.histology was performed as described previously14. in brief, at the end of recordings, the bats were anaesthetized, and electrolytic lesions (dc positive current of 30 μa, 15-s duration) were made to assist in the precise reconstruction of tetrode positions. the bat was then given an overdose of sodium pentobarbital and, with tetrodes left in situ, was perfused transcardially using 4% paraformaldehyde or 4.5% histofix. the brain was removed and thin coronal sections were cut at 30 μm intervals. the sections were nissl-stained with cresyl violet and were photographed to determine the locations of tetrode tracks in the dorsal ca1 (extended data fig. 3a). recording sites were all located in the dorsal ca1 (except for one tetrode from one bat, which was possibly placed in ca2, that was also included in the dataset), and spanned the entire extent of the proximo-distal axis of ca1.spike-sorting procedures were similar to those described previously13,14. in brief, spike waveforms were sorted manually using plexon offline sorter, on the basis of their relative amplitudes on different channels of each tetrode. data from all the behavioural sessions and sleep sessions from the same recording day were spike-sorted together. well-isolated clusters of spikes were manually selected, and a refractory period (<2 ms) in the interspike-interval histogram was verified. spike sorting was performed in consecutive time windows to allow for drift correction of the spike clusters.in total, we recorded 499 well-isolated ca1 neurons from 4 bats. we further analysed only 430 neurons that were valid for analysis (see the inclusion-criteria below). out of the 430 valid neurons, we detected 389 putative pyramidal neurons (90.5% of the cells; based on average firing rate <5 hz during the entire recording session), and 41 putative interneurons (9.5%; firing rate ≥5 hz). as hippocampal place cells are known to remap between movement directions in a linear track14,44,45 (extended data fig. 3g), we separated all analyses into flight directions and considered each direction independently. cells × directions were defined as valid for analysis on the basis of the following behavioural and neuronal inclusion criteria: (1) 10 or more cross-overs per flight direction; and (2) or (3), where: (2) a minimum of 50 spikes per direction during solo flights; (3) a minimum of 30 spikes per direction during cross-over flights. this resulted in 693 pyramidal cells × directions and 74 interneurons × directions that were valid for analysis in this paper.unless otherwise noted, for all the pairwise comparisons, we used two-tailed (two-sided) statistical tests, with a probability threshold of p = 0.05. all correlations were based on a two-tailed pearson’s correlation coefficient (except for a few cases in which we used non-parametric spearman correlations, if the scatters were clearly non-gaussian). we used two-sample kolmogorov–smirnov tests to compare distribution shapes. to determine the significance of place tuning and of distance tuning, we compared the real data with shuffled data (see below). when plotting shuffle tuning curves for neurons, we always plotted 5–95% of the shuffle tuning curves.as explained above, we performed all analyses in this article separately for the two flight directions. tuning curves for 1d position (place tuning) were computed by counting the number of spikes and the time spent in each spatial bin (0.5 m bins). bins with a time spent of <0.8 s were discarded from the analysis (corresponding to around 11 flights passing through that bin). spike-count maps and time-spent maps were then smoothed (gaussian kernel σ = 3 bins = 1.5 m), and we then divided, bin by bin, the smoothed 1d spike-count map by the smoothed 1d time-spent map. we computed the spatial information (si) as follows: \({\rm{si}}\left(\frac{{\rm{bits}}}{{\rm{spike}}}\right)=\sum _{{\rm{i}}}{p}_{i}\left(\frac{{r}_{i}}{\bar{r}}\right){\log }_{2}\left(\frac{{r}_{i}}{\bar{r}}\right)\), where ri is the firing rate of the cell in the ith bin, pi is the probability of the bat to be in this bin and \(\bar{r}\) is the mean firing rate of the cell.place cells were classified using data from solo flights on the basis of the following inclusion criteria: (1) significant spatial information compared to shuffle (>99% of the shuffles): to shuffle the spike train, we rigidly and circularly shifted in time the spikes of each flight, using a uniform random shift; the value of the shift differed randomly between individual flights, so each shuffle consisted of a unique set of temporal shifts across the set of flights. we performed 1,000 such shuffles. (2) spatial information was >0.25 bits per spike. (3) the cell emitted ≥50 spikes during solo flights. (4) the cell had at least one significant place field, as described next.place fields were detected during solo flights similarly to our previous study14: (1) first, we extracted local peaks in the firing rate map, with a peak rate of >0.5 hz. (2) to remove small local peaks ‘riding’ on a large field, we searched for shallow ‘dips’, that is, cases in which the dip between two adjacent peaks was >50% of the firing rate of the larger peak, and then disregarded the lower peak. (3) we next defined the field width as the zone in which the firing rate was ≥20% of the peak firing rate of that place field. (4) field stability criterion: we required at least five different laps with spikes to have occurred inside the place field, or 20% of the laps with spikes—whichever is larger. (5) field significance criterion: to capture clear distinct fields, we treated a place field as significant only if it had significant spatial information in its local area, near the place field. to quantify this, we focused on the local area surrounding the place field (the width of the field itself plus 50% of the field’s width in each direction), and calculated the spatial information in this local area for the real spikes, and also for 1,000 shuffles (same rigid shuffling of spikes as above). we considered the field to be significant only if it had spatial information of >95% of the shuffles in the same local area.tuning curves for the 1d distance between the bats were computed by counting the number of spikes in each distance bin (2 m bins), and dividing it by the time spent in each bin. bins with a time spent of <0.4 s were discarded from the analysis. the tuning curves were next smoothed (rectangular window of 3 bins). note that the 1d interbat distance along the tunnel axis was highly correlated with the euclidean distance between the bats and with the time to cross-over (extended data fig. 4d–g; mean pearson correlation: r = 0.99999 and r = 0.9987, respectively), so any of these variables could be used to analyse the data; for consistency with the 1d position coding, we focused on the 1d interbat distance along the tunnel.for classifying neurons as 1d distance cells, we computed two types of shuffles, and required the neuron to be significant according to both types of shuffles: (1) cross-over data shuffle: this shuffle was aimed to test whether during cross-overs the neuron showed enhanced or suppressed distance responses relative to the cross-over data. we performed 10,000 rigid spike shuffles for the flight data, as we did for the place cell classification above, but here used the data from the cross-over flights. (2) solo projected on cross-over shuffle: owing to the prominent position coding in the hippocampus, this shuffle was aimed to test whether during cross-overs the neuron showed enhanced or suppressed distance-responses relative to the expected response from the solo data. we performed 10,000 shuffles in which we projected the solo spikes onto the cross-over behavioural data as follows (illustrated in extended data fig. 5a). for each cross-over flight, we pooled all of the solo flights that occurred within the same position in the tunnel and, for each shuffle, we randomly picked one solo flight out of this pool (extended data fig. 5a (i and ii)). we then computed what should be the projected interbat distance of each spike that occurred during this solo flight on the basis of the cross-over flight data (using linear interpolation; extended data fig. 5a (ii and iii)). this yielded 2d distance by position shuffle datasets of spikes that occurred during solo, projected onto the cross-over behaviour (extended data fig. 5a (iv)). this entire process was repeated 10,000 times, creating nearly unique shuffle datasets (across cells, 99.99% of shuffles were based on unique sets of solo flights). this shuffle conserves the spiking statistics of the neuron and its position tuning. this shuffling procedure reflects the null hypothesis that the expected firing pattern of the neuron is driven only by the position along the tunnel, without exhibiting any tuning to interbat distance.to detect significant 1d distance modulation of firing rate, we looked for bins along the interbat distance axis, which exhibited significantly high or significantly low firing rate compared with both types of shuffles. this was done as follows: we first smoothed with a three-bin rectangular window the real distance tuning curve and all of the shuffled tuning curves (this smoothing was performed to avoid detection of transient increase or decrease in firing rate). we next computed the percentile of each bin from the real distance tuning curve compared with the shuffles’ values for the same bin. to correct for multiple comparisons for the number of bins, we computed the average response width, and required the following corrected critical-value: \(\frac{\alpha }{{n}_{{\rm{total}}{\rm{bins}}}}\times {n}_{{\rm{bins}}{\rm{in}}{\rm{width}}}\), where: α = 5% (the standard critical-value significance criterion, before correction (95% shuffling)); ntotal bins = 40 (total number of 2 m bins of distance within the ±40 m distance range); and nbins in width = 4 (average response width = 4 bins = 8 m). this resulted in αcorrected = 0.5% (two-sided), that is, we considered the firing rate in this bin to be significant if it was above the 99.5% percentile or below the 0.5% percentile of the shuffles. to prevent edge effects, we removed significant bins from the edges of the ±40 m range (that is, if the first or last bin were significant). moreover, in each of the shuffles, we considered bins to be significant only if they had at least one additional significant neighbouring bin (that is, we required ≥2 adjacent significant bins; single significant bins were discarded). finally, we considered a bin to be significant only if it was significant at the 99.5% level according to both types of shuffles (cross-over shuffle, and solo projected on cross-over shuffle). this requirement to be significant according to two fundamentally different shuffling procedures ensured that only robust distance tuning would be detected.1d distance cells (cells with significant 1d distance tuning) were defined by analysing the 1d distance tuning, using the following criteria: (1) the 1d tuning had significant distance bins above or below both types of shuffles (as described above). (2) the cell emitted ≥30 spikes during cross-overs in that flight-direction. (3) stability of the tuning curve: pearson correlation of r ≥ 0.3 between distance tuning curves computed in even flights and odd flights. we note that most of the cells with significant 1d distance tuning were not purely tuned only to distance, but rather had complex 2d tuning to distance by position (figs. 3a,g and 5).during cross-overs, bats tended to slightly lower their speed and slightly deviate laterally to avoid colliding with each other (extended data fig. 6b,c (speed and velocity y, respectively)). to test whether the distance modulation of the neurons is genuine and is not due to neuronal responses to these movements, we reasoned that we can compute the tuning to these movement variables during solo flights to disentangle it from the cross-over effects: if a cell is modulated by a movement variable, we expect to see the same movement-related modulation both during solo and during cross-over flights. we considered three movement-related variables that could potentially modulate the firing rate of the cells—we focused on speed and velocity because previous studies have shown that some hippocampal neurons are sensitive to movement speed or to manoeuvring44,46: (1) speed: \(s=\sqrt{({{v}_{x}}^{2}+{{v}_{y}}^{2})}\) where vx is the velocity along the long axis of the tunnel, x, and vy is the velocity along the lateral axis of the tunnel, y (see extended data fig. 6a for an illustration of the x,y axes); (2) vy, velocity in the y axis, reflecting deviation (manoeuvring) in the lateral axis of the tunnel; and (3) sy, speed in the y axis (absolute y velocity, irrespective of the direction of the deviation). the positional resolution along the z axis was not high enough to analyse behavioural modulations in z, but observations during the experiment indicated that the deviations in z were small.for each movement variable, we built solo tuning curves and cross-over tuning curves (extended data fig. 6d–f). to compare between solo and cross-over, we limited the data from which we built both tuning curves to include the same range of flight speeds in both cases; the range was set to 5–95% of the flight speeds during cross-overs, computed separately for each bat. we computed the tuning curves as described above (see the ‘1d distance tuning and classification of 1d distance cells’ section), using bin sizes of 0.2 m s−1 for velocity y and speed and 0.1 m s−1 for speed y. to evaluate the significance, we used 10,000 circular shuffles of the spikes as follows: we concatenated all of the in-flight spikes across all of the flights (separately for solo and cross-over flights), and we then rigidly shifted the times of all of the spikes by a random time interval in a circular manner (with the end of the session wrapped to the beginning). for each shuffle, we computed velocity tuning and speed tuning as for the real data. we then fitted a linear function to these tuning curves for both the solo and cross-over data, as well as for their shuffles, as velocity and speed modulations were found to be approximately linear in the hippocampal formation47,48. we defined cells as significantly modulated by velocity or speed if the slope of the linear fit was >97.5% percentile or <2.5% percentile of those seen in the shuffles (with significance assessed separately for the solo and for the cross-over conditions; extended data fig. 6g–i). in total, we performed 6 linear fits = 3 movement variables (s, vy, sy) × 2 behavioural modes (solo, cross-overs). we considered a cell to be movement-modulated by one of the variables if it was significantly modulated by this movement variable both in solo and in cross-over, and had the same slope direction of the tuning during both solo and cross-over. the results of these control analyses are shown and further elaborated in extended data fig. 6 – which ruled out any major contribution by velocity or speed.to exclude the possibility that the observed distance tuning during cross-over is directly linked to the echolocation clicks—that is, reflects a direct sensory neuronal response to the clicks themselves (auditory responses) or a motor neuronal activity before individual clicks—we used the solo flights as a control. as during the solo flights bats also emit echolocation clicks (albeit at a lower rate; fig. 1e (black error bar) and extended data fig. 2b), we tested whether the neurons show any auditory/motor response to the clicks when appearing outside of the context of cross-overs, and examined whether such responses could explain the distance tuning observed during cross-overs. to this end, we computed click-triggered responses during solo flights at ±200 ms around each click, using 10 ms bins, and averaged the responses across clicks (extended data fig. 7a (bottom, black lines)). we compared each click-triggered response to 10,000 shuffles (rigid circular shuffling of spikes within the ±200 ms time window around each click, similar to the shuffling described above for place tuning), and considered a bin to be significant if it was above the 99.5% percentile or below the 0.5% percentile of the shuffles (corrected for multiple comparisons as described above, assuming 4 bins = 40 ms for the minimal duration of sensory/motor response). to exclude transient and unreliable responses, we considered only modulations that were significant in two or more consecutive bins. this analysis was performed on all of the 1d distance cells that were recorded simultaneously with audio (n = 41 cells × directions). the results of these control analyses are shown in extended data fig. 7a–d and they strongly argue against the possibility that the 1d distance tuning could be explained by sensory or motor responses to clicks.to test how attention modulates the distance tuning curves and firing rates of the neurons during cross-overs, we used the increase in echolocation click rate as an index of attention1,2,3,4,5,6,7,8,9,38,39,40,41. for 1d distance cells that were recorded simultaneously with audio (which was performed in one bat), we divided the cross-over flights into two equally sized groups according to the click rate (median bisection). this yielded two sets of flights: flights with high click rate versus flights with low click rate (reflecting high versus low attention). we then computed the tuning curves separately for these two sets of flights (as done above for the full 1d tuning curves). the separation to flights with high and low click rates was based on the mean click rate in a distance window between −15 to 0 m (this distance window matches the typical region in which the click rate was increased during cross-overs; fig. 1e and extended data fig. 2c). click-rate tuning curves were computed for each individual cross-over flight (using a bin size of 2 m and smoothing by a gaussian kernel with σ = 1.5 bins). we included in this analysis only valid flights that met the following criteria: (1) the flight had enough continuous distance data (from −25 to 5 m with no gaps; 4.4% of the flights were excluded); (2) the peak click rate was greater than 10 hz—this threshold was used to exclude rare atypical cases of very sparse use of echolocation (on average 2.56 flights per direction per session were excluded, 5.6% of the flights in total); and (3) more than twofold change in sonar click rate during cross-over relative to the preceding minimum—here we removed atypical flights with almost no modulation of sonar click rate along the cross-over flight (this excluded 2.8% of the flights).after applying these criteria for valid flights, we included in this analysis only cells that had 20 or more valid cross-over flights, and 30 or more spikes in high-attention trials or low-attention trials (similar to the requirement of 30 spikes in the main analysis of 1d distance tuning). this left for analysis n = 37 cells × directions out of the n = 41 total 1d distance cells that were recorded simultaneously with audio.to examine the difference between the tuning curves in high-attention versus low-attention flights, we focused on a window of ±10 m around the peak firing rate of each cell (peak firing rate of the 1d distance tuning curve using all cross-over flights), and computed within this window two quantities: (1) the rate difference of the peak firing rates between the high-attention tuning curve and the low-attention tuning-curve, and (2) the rate difference of the mean firing rates between the two tuning curves. for significance, we divided randomly 10,000 times the cross-over flights into two groups, and computed the same two quantities, resulting in two shuffle distributions (extended data fig. 7e (bottom row)). cells that were higher than the 95th percentile in one of these shuffle distributions were defined as significantly attention modulated (n = 11 cells × directions, comprising 29.7% of the cells in this analysis; see fig. 2e and extended data fig. 7e for examples and fig. 2f,g for the population).to test whether during cross-overs there is representation of the position of the other bat in world coordinates (that is, representation of the other bat’s allocentric position)—as opposed to representation of the distance from the other bat—we computed the corresponding 1d tuning curve: the firing rate of the neuron as a function of the position of the other bat (using the same procedure as described above for the tuning curve for self position). we defined a cell to be significantly tuned for position of the other bat if it passed the following criteria: (1) criteria identical to those used for determining position tuning for self place cells: (i) significant spatial information (99% percentile) compared to shuffles; (ii) spatial information was >0.25 bits per spike. (2) criteria identical to those used for determining distance tuning during cross-over, as here the analysis was done during cross-over flights: (i) the cell emitted ≥30 spikes during cross-over flights; (ii) stability of the tuning-curve over even and odd flights: pearson correlation of r ≥ 0.3 between these tuning curves. the results of these control analyses are shown and further elaborated in extended data fig. 8, ruling out the possibility that, in this particular experiment, the bat’s hippocampal ca1 cells represented the position of the other bat; rather, the neurons represented the distance to it.computation of the 1d distance tuning curves within place fields (fig. 3a and extended data fig. 11a) was performed on the cross-over data, using only segments of behavioural data and neuronal data that occurred within the place field (the place field was defined during solo-flights, as described above). for computing the 1d distance tuning curves in interfield areas (between place fields), the interfield area was defined as follows: after we expanded each place field by 50% of its width to both sides (thus adding extra margins), the remaining areas between these expansions were defined as interfields. these extra margins were removed to prevent leakage of spikes from the adjacent place fields into the interfield. we then computed the 1d distance tuning curves for data within fields/interfields in the same way as it was computed for the entire cross-over data (described above), with small modifications to account for the smaller amount of data available within fields/interfields: (1) we used larger distance bins (2.6667 m; 30 bins); and (2) we discarded bins with less than 0.1 s time spent. to include place fields and interfields with good coverage and reliable spiking, we analysed only tuning curves with at least 30 spikes (as in the 1d tuning curve) and for which at least 80% of the distance bins were valid (above the minimal time spent of 0.1 s). note that most interfields had, by definition, a small number of spikes, and their tuning could therefore not be analysed reliably (n = 87 interfields were valid for analysis). the resulting 1d tuning curves were based on 20.87 ± 6.55 flights per place field and 29.41 ± 12.38 flights per interfield (mean ± s.d., across all place fields or interfields).to identify significant bins in these tuning curves (within fields/interfields), we performed a similar analysis as described above for the full cross-over data, but with slight modifications to account for the smaller amount of data. after finding the significant bins in both types of shuffles as described above (cross-over rigid shuffles and solo projected on cross-over shuffles), we removed significant bins at the edges of the distance range. we then considered a bin to be significant if it was significant in one type of shuffle (above the 99.5% percentile or below the 0.5% percentile of the shuffles, that is, corrected for multiple comparisons as described above), and was also above the 95% percentile or below the 5% percentile of the other type of shuffle. we required that the number of flights that contributed to a significant distance field (the consecutive set of significant bins) was at least two flights. the number of flights differed between narrow and wide fields; across the population, the mean number of flights per distance field was 8.13 ± 4.12 (mean ± s.d.).to quantify how rapidly place cells can change their representation from representing position to representing distance by position (fig. 3c and extended data fig. 11e), we analysed switch times for individual place fields. we first recomputed the tuning curve within the place field in terms of time to cross-over rather than interbat distance (using the same number of bins). as time to cross-over and interbat distance are highly correlated (extended data fig. 4d,e; pearson r = 0.9987 ± 0.0009 (mean ± s.d.)), the tuning curves were highly similar to each other. we next created a shuffle distribution using the cross-over rigid shuffling (as above), and computed the median of these shuffles per time bin. we upsampled (×10) both the real data and the median shuffle tuning curves to get finer temporal resolution. we next computed the time difference between the time point at which the real data crossed the median of the shuffle, and the time point of the first significant bin, and defined this time difference as the rise time for enhancement and fall time for suppression (fig. 3c (dark green in the top plot and dark brown in the bottom plot)). similarly, we defined the time difference between the time point of the last significant bin and the time point at which the data subsequently crossed the median of the shuffle as the fall time for enhancement and rise time for suppression (fig. 3c (light green at the top and light brown at the bottom; see the arrows)). we computed these switch times only for tuning-curves with one significant enhancement or one significant suppression (not both), and only when the modulation crossed the median shuffle on both sides, resulting in n = 204 fields (out of a total of n = 303 significant fields), of which n = 143 were enhancement tuning curves and n = 61 were suppression tuning curves.in fig. 5b,c (correlations of distance tunings between place fields), we excluded pairs of tuning curves if both place fields did not have significant distance modulations to avoid correlating small random noises, or if the position gap between the place fields was smaller than half their average width to avoid ‘leaking’ of spikes from one field to the other.2d firing-rate maps for interbat distance by position were computed by counting spikes and time spent in each 2d bin (bin size: 3 × 3 m), which resulted in two 2d maps—a spike-count map and a time-spent map. bins with time spent <0.2 s were discarded from the analysis, unless an adjacent bin was visited. we smoothed the spike map and the time-spent map with a 2d gaussian kernel (σ = 1.5 bins = 4.5 m). the 2d firing rate map was then computed by dividing bin by bin the smoothed spike-count map by the smoothed time-spent map. note that identical binning and smoothing were also used for plotting 2d distance-by-position maps of click rate and velocity (fig. 1f and extended data figs. 2d and 6b,c).to find regions in the 2d firing-rate maps for distance by position that were significantly modulated (significant 2d patches; fig. 3f and extended data fig. 12e,f), we used cluster-based analysis49,50. this method, which is widely used for analysing data from functional magnetic resonance imaging and electroencephalography experiments, searches for contiguous groups of significantly modulated bins or pixels. first, we compared the firing rates in each bin of the real 2d map with the firing rates in the same bin in all 10,000 shuffle maps (using solo projected on cross-over shuffling; see extended data fig. 5c for examples of shuffle maps), and computed the p value for each bin on the basis of its percentile compared with all the shuffle maps. here we used the solo projected on cross-over shuffle because it accounts for the prominent position coding in the hippocampus, and it reflects the null hypothesis of how a neuron would have responded if it was only place-tuned and was not modulated by the interbat distance (see above for the description of this shuffling; extended data fig. 5a,c). second, neighbouring bins that passed a significance threshold of p > 0.995 were clustered together as enhancement clusters, and neighbouring bins that passed a threshold of p < 0.005 were clustered together as suppression clusters. for each cluster, we computed the surprise values for each bin (surprise was defined as –log10[p] for suppression clusters and –log10[1 − p] for enhancement clusters). we then summed the surprise values over all of the bins in that cluster to get the cluster score. we did this entire procedure (first and second step) both for the data 2d map and for all 10,000 shuffle 2d maps (treating each shuffle map as if it was a data map). third and finally, we then compared the cluster scores in the data 2d map with the distribution of the highest cluster score in each shuffle 2d map (separately for enhancement and suppression). we considered clusters that were ranked above the 95% percentile compared with the shuffle as significant 2d patches. we then considered only 2d patches that passed additional two criteria, both of which were aimed to accept only patches that were based on enough behavioural-data: (1) at least 2 s of total flight time inside the 2d patch; and (2) on average at least 0.15 s of flight time for each bin in the patch (3 × 3 m bins). moreover, we used three spike-based criteria for enhancement patches only (not for suppression patches)—these criteria were aimed to accept only enhancement patches that contained enough spikes: (1) at least 20 spikes inside the 2d patch, (2) average of at least 0.5 spikes per bin, and (3) at least 3 flights with spikes inside the 2d patch. we performed this analysis on all of the pyramidal cells that had a peak firing rate of ≥2 hz in their 2d map (n = 607 cells × directions). applying all the above criteria enabled us to conduct the analysis only on cells with reliable behavioural coverage and robust firing rates. note that the patches were generally quite localized along the distance axis (the median distance patch width was 24.6 m for enhancement patches and 18.5 m for suppression patches, with the median taken over the maximum distance width for each patch; the median over the average width for each patch was 16.9 m for enhancement patches and 12.3 m for suppression patches).a cell was defined as a significant 2d distance-by-position cell if either: (1) it had significant modulation of firing rate within a place field or interfield (see above; fig. 3a,d and extended data figs. 11 and 12a–d); or (2) it had a significant patch within the 2d distance by position map (see above; fig. 3f and extended data fig. 12e,f). these were the n = 366 cells × directions that were marked as cells with 2d distance by position tuning in fig. 3g (purple ellipse).we simultaneously decoded the interbat distance and the position of the bat during cross-overs (fig. 4e–h and extended data fig. 13) using a bayesian maximum-likelihood decoder11,51. decoding was performed for each flight direction separately. we performed leave-one-out cross-validation, in which each cross-over flight served as test data, while the remaining flights were used to build the 2d firing-rate map for each cell (train data). we analysed only sessions with ≥10 simultaneously recorded cells (16 sessions; n = 13.19 ± 3.08 cells per session (mean ± s.d.); for the decoding analysis, we included all cells without any exclusion criteria).the decoded position and interbat distance at every moment were those that maximized the log-likelihood function, assuming poisson firing, that is, maximized:the term on the left denotes the log-likelihood of the bat being located in a specific combination of (distance, position) = (xd, xp) given the observation of a vector of {ni} spikes in each of the n neurons. on the right, the first term corresponds to a sum of the log of the spatial tunings of all neurons (that is, \({f}_{dp,i}({x}_{d},{x}_{p})\)), weighted by their activity (ni) in the integration window τ, that is, the time bin used for decoding (we used τ = 1 s, with a 250 ms overlap: a relatively long time window, which was used due to the relatively small number of neurons). the second term corresponds to a correction for unequal coverage of the neuronal representation in different locations. the third term on the right side corresponds to the prior for the decoding (p(xd,xp)), which is needed due to the non-perfectly-uniform behaviour (time spent in the 2d distance by position space). the decoded position and distance coordinates were then taken as the combination that maximizes a(xd,xp|{ni}), that is, the maximum of the log-likelihood function.in fig. 4c, we used the same type of decoding, but instead of using the 2d firing-rate map we used the 1d position tuning computed based on the solo flights to decode the position during cross-over flights (fig. 4c (pink)). chance error was estimated by computing the median difference between the actual (real) positions and 100 random positions, which were sampled from the experimentally measured behaviour of the animal, to account for non-homogeneous behaviour (fig. 4c (grey)).in fig. 4a–d, we used a 10 m distance sliding-window (2 m steps), and computed position tuning curves during cross-over flights separately for each distance window. these were then used to compute correlations with solo position tuning (fig. 4a), spatial information (fig. 4b) and mean normalized firing rate (fig. 4d).to quantify the non-separability of the 2d distance-by-position coding, we performed a singular value decomposition (svd) analysis on the 2d distance by position firing-rate map, denoted here by the matrix m. this is a standard analysis performed in neuroscience to assess the separability of 2d coding31,32,33,36,52. in this analysis, we decompose the matrix m (throughout this analysis, the matrix m was always mean-subtracted before the svd decomposition):here u and v are matrices containing the singular vectors corresponding to the position and distance axes, respectively, and s is a diagonal matrix with non-negative singular values (sj in descending order); the superscript t denotes matrix transpose. this analysis enabled us to test whether the matrix m, namely the 2d distance by position firing-rate map, is completely separable, which means that it equals the first column vector in u multiplied by the first column vector in v × s1 (see extended data fig. 14a (cell 117), where the first dimension, that is, the multiplication of the first two vectors, is almost identical to the original matrix); otherwise the matrix m is non-separable and requires additional terms, each being a product of vectors from u and v scaled by the corresponding sj (extended data fig. 14a (cells 325 and 235)). we computed two types of measures to quantify the non-separability, based on the singular values. these measures, λ and α, were: (1) λ is the exponential decay fitted to the singular values: \({s}_{j}=a\times {e}^{\frac{-j}{\lambda }}\). for separable cells, the decay is fast, that is, λ is small, whereas, for non-separable cells, λ is large. (2) \(\alpha =1-\frac{{s}_{1}^{2}}{\mathop{\sum }\limits_{j=1}^{n}{s}_{j}^{2}}\): the fraction of variation in m that is not captured by the first singular value s1. for separable cells the first singular value is large relative to the subsequent singular values, and therefore α is close to zero; by contrast, non-separable cells have larger values of α (ref. 31). note that these two measures, λ and α, are highly correlated among themselves (pearson r = 0.98, p = 7.1 × 10–172, n = 262 cells × directions).as svd analysis requires a rectangular matrix m, and our 2d firing-rate maps were non-rectangular (see the 2d distance by position maps in fig. 2a), we cropped our 2d map along the position axis (y) such that in each row we will have at least 80% valid distance bins (80% of the ±40 m range). we computed the 2d firing rate map again using only spikes and behavioural data that occurred within this cropped position area (this cropping is the reason for the smaller y-range (positions) of the maps in fig. 5e as compared to fig. 2a). to create a full rectangular map as svd requires (that is, to fill non-visited bins in the 2d map) we used the following iterative procedure to estimate the matrix entries while not adding any excess non-separability: (1) we initially filled-in the empty bins on the basis of the local mean firing rate of the neighbouring bins; this created a full matrix, mfirst iteration. (2) we next computed the svd for this new full matrix mfirst iteration, and changed the values of the original empty bins to values computed from the first 10 singular values and vectors, resulting in a new matrix, msecond iteration (using a large number of 10 singular values ensured that this estimation procedure would not restrict the map dimensionality). we then computed the sum of squared differences between the current matrix msecond iteration and matrix mfirst iteration. (3) we iteratively continued to change the values of these bins by computing the svd and building a new matrix mi, and then computing the sum-of-squared-differences between the current matrix mi and the previous matrix mi − 1, until reaching convergence (sum of squared difference smaller than 0.001). the final matrix used in this analysis was referred to as msvd, which is rectangular and has no empty bins.we conducted svd analysis only on pyramidal cells with significant distance modulation either in 1d or 2d that met the following criteria. criteria on behavioural coverage: (1) the length of the position axis of the cropped rectangle was ≥45 m. (2) the largest position gap between adjacent cross-over flights was <10 m (that is, there were no large ‘holes’ in the behavioural coverage). (3) the number of cross-overs in the cropped map was >10. criteria on spiking: (4) the number of spikes in the cropped map was >30. (5) the peak firing rate in the cropped 2d map was >2 hz. applying these criteria enabled us to conduct the analysis only on cells with reliable behavioural coverage and robust firing rates (n = 262 cells × directions).to assess the significance of λ and α, we used as shuffles our 2d matrices from the solo projected on cross-over shuffle (see above; and see examples in extended data fig. 5c). these maps were cropped and filled in the same way as the data map, and as by definition they exhibit only position tuning, we multiplied each row of the 2d matrix by the 1d distance tuning of the cell (extended data fig. 14c (bottom panel in each shuffle); multiplied map). this results in matrices with the same behavioural data, the same spike statistics and the same 1d distance tuning as in the real data, but these ‘multiplied maps’ are almost separable, and any non-separability that we would measure in them must therefore arise from non-uniform coverage of bat behaviour or from noisy spiking. thus, by comparing the 2d data maps to these shuffles, we can test whether the detected non-separability in the cell’s 2d data map is genuine, or whether it originates from noisy spiking or from non-homogenous behaviour. cells were defined as significantly non-separable cells if both their λ and α were above the 95% percentile of the shuffle distribution, and their rounded projection dimension was ≥1 in the cross-validation test (see below).we also performed a cross-validated svd analysis to assess the dimensionality of the matrix53 (extended data fig. 14d). here we divided the bins in the matrix msvd into train bins (90%) and test bins (10%, which were randomly picked for each of the 1,000 iterations of the cross-validation). we first set the values of the 10% test bins to the average value of the entire matrix msvd. we then used svd to reconstruct this matrix (90% real data, 10% set to the mean value) with increasing cumulative dimensions (for example, cumulative dimension 2 = u1 × s1 × v1t + u2 × s2 × v2t; x axis in the bottom left panel of each cell in extended data fig. 14d). we iteratively changed the test bins using the same method as described above for filling-in the empty bins, until reaching convergence. we next computed (separately for the test and the train bins) the mean squared error between the values of the original bins and the values in the new reconstructed matrix using different cumulative dimensions. for the training bins, it is guaranteed that the error decreases as we add more dimensions (that is, as we increase the cumulative dimension). however, for the test bins, the error will decrease only if the added dimension indeed describes the data; thus, at some point, the error will start to increase when adding more dimensions because the additional dimensions are over-fitted to the training portion of the data, and therefore effectively add noise. we therefore define the cumulative dimension with the minimal test error as the meaningful dimension of the data (extended data fig. 14d (bottom left panel in each cell): minimum of red curves). finally, to remove any non-separability that may result from the non-uniform behavioural coverage, we carried out the same procedure also for the median map of the solo projected on cross-over shuffles (extended data fig. 14d (right column for each cell)). then, to assess the real dimensionality of our data, excluding the behavioural dimensionality, we computed the projection dimension: for each of the 2d matrices—the cross-over data matrix and the solo-median matrix—we took only the meaningful vectors from u and v (all of the vectors until and including the meaningful dimension); and projected the vectors of the solo median map out of these data vectors. this results in a subspace that is orthogonal to the solo median map space and therefore does not contain the behavioural dimensionality anymore:where udata and vdata are matrices containing the meaningful vectors of the data, and usolo and vsolo are matrices containing the meaningful vectors of the solo median map. then, the projection dimension of the data excluding the behavioural dimensionality was computed as the minimum of the sum of the normalized projected vectors:to assess the possible functional role of the observed non-separable maps (figs. 3a and 5), we created populations of neurons with simulated distance by position maps, and systematically studied the effect of map separability on decoding performance. all of the simulations were conducted using matlab.in our simulations, the bin size was 0.5 m both for the distance coordinate (xd, interbat distance; between ±40 m) and for the position coordinate (xp, position in the tunnel; between 0–130 m; we simulated the 130 m that were effectively covered by the bats). we note that below we make repeated use of the gamma distribution, defined by a shape parameter k and a scale parameter θ, to fit the model to the empirical data. the 2d distance by position map of neuron i is denoted below by fdp,i(xd, xp).position tunings were generated using a similar procedure as in our previous work14, with slight modifications of the parameters to fit the current experimental dataset. in brief, for each model neuron, we randomly picked a position coverage value from a gamma distribution that was fit to the data (kcoverage = 1.76, θcoverage = 0.18); if this sample value was larger than 0.8, we resampled. next, we sampled field sizes from a gamma distribution fitted to the data (kfield-size = 4.62, θfield-size = 2.68 m), adding fields until the cumulative (total) sizes of all fields reached the coverage value. this number of place fields is denoted nfield. then, the field locations were randomly and uniformly distributed along the environment, with no overlaps. to avoid distorting the uniform distribution of fields near the boundaries of the environment, we allowed fields to be located anywhere and we truncated them at the boundaries. this procedure created cells with multiple place fields, where the sizes of the fields of the same neuron were broadly distributed, as seen in the experimental data.distance modulation profiles were generated as follows. for each neuron, the number of distinct distance profiles was set to ndis = nfield × xsep (rounded up, where xsep is a parameter controlling the degree of non-separability). we varied xsep between 0.2 and 1 in jumps of 0.2 (extended data fig. 15a (columns)). each field was assigned with one of the ndis modulation profiles. when ndis = 1, all fields undergo the same distance modulation (maximal separability), and when ndis = nfields, each field undergoes different distance modulation (maximal non-separability). we generated ndis sets of field-modulation values: distance modulation was enhancing/suppressing/not modulated with a probability of 0.38/0.20/0.42, respectively (numbers fitted to the experimental data). across the population, the average number of fields that underwent distance modulation was independent of xsep because the probabilities (0.38/0.20/0.42) were independent of xsep. the centre location of each distance-modulation profile was sampled from a gaussian distribution (µ = 0 and σ = 16.8 m; fitted to the experimental data), and the profile width was sampled from a uniform distribution between 4.3–12.9 m (the average of that distribution was matched to the experimental data). when a field is enhanced/suppressed, the firing rate in the region modulated by the distance coordinate was multiplied by a factor sampled from a gamma distribution (kenhance = 9.98, θenhance = 0.32; ksuppress = 0.39, θsuppress = 0.17; fitted to the experimental data).we also added 2d distance-by-position modulation irrespective of place fields (extended data fig. 15a (hotspots)), to reflect better the experimental data, where activation hotspots were found in the interfield analysis (fig. 3d and extended data fig. 12a) and in the patch analysis (fig. 3f and extended data fig. 12e,f). the distance-by-position firing rate map of each neuron had a hotspot with probability (xsep − 0.2)/0.8 (that is, no hotspots when xsep = 0.2 and one hotspot for each neuron when xsep = 1). the size, position and increase in firing rate of the hotspot was sampled similarly to the distance enhancement modulation profile. the position of the hotspot centre was sampled uniformly.the parameter xsep enabled us to create 2d distance-by-position maps fdp,i(xd, xp) with differing non-separability levels (extended data fig. 15a (columns)). after maps were generated, we computed for each 2d map the non-separability indices of the svd analysis, λ and α, as we did for the experimental maps (fig. 5e–g; see the definitions of λ and α in the ‘svd analysis’ section above).we assumed that the animal starts each iteration (each ‘simulation-trial’) at a position xp = x0p in the tunnel (between 0 and 130 m) at a distance xd = x0d from the other bat (between ±40 m). both animals fly at a speed of v = 8 m s−1 for a time interval δt = 500 ms, in opposite directions. the expected spike count of the neuron during that trial is based on the bat’s trajectory through the 2d map fdp,i(xd, xp), and is given by:where m0 is the in-field expected spike count without distance modulation: we used m0 = 5 in all our simulations, as in ref. 14. the factor 2 in x0d + 2vt reflects the double distance travelled when each of the two bats flies at a speed v towards the other. the actual spike count in each trial was drawn from a poisson distribution with rate mi, and is denoted below as ni.we employed two commonly used types of decoders: a maximum-likelihood decoder and a population vector decoder.for the maximum likelihood (ml) decoder, we computed the log-likelihood for each neuron, and summed over the n neurons11,14,51:the term on the left side denotes the log-likelihood of the simulated bat being located in a specific combination of (distance, position) = (xd, xp) given the observation of a set of {ni} spikes in each of the neurons i. on the right side, the first term corresponds to a sum of the log of the spatial tunings of all neurons, weighted by their activity; the second term corresponds to a correction for unequal coverage of the neuronal representation in different locations. this equation is very similar to the equation used for decoding the data, with the main difference being that here we created a uniform coverage and therefore did not include a term for the prior. this is an approximation of the likelihood function, where the decoder knows each neuron’s firing rate map (that is, fdp,i(xd, xp)), but it does not rely on continuously computing a convolution of the firing rate map with the animal’s motion and the other animal’s motion. the decoded position and distance coordinates were then taken as the combination that maximizes aml(xd, xp|{ni}), that is, the maximum of the log-likelihood function.we considered population sizes n between 20 and 200 neurons, in jumps of 20. for each value of xsep and n, we generated 250 random populations. for each population, decoding was done in 41 equally spaced distances (between ±40 m) and 11 equally spaced positions (between 0 and 130 m), that is, 451 combinations of distance by position; we used a larger number of distances as in this study we focused on the distance modulation. for each distance-by-position combination, spike counts were randomly generated five times. decoding errors were computed after grouping the data in three different ways: (1) based on the non-separability parameter used to generate the maps, xsep (extended data fig. 15d,e); (2) based on the λ value of the svd analysis computed post hoc for each population (fig. 5h,i); and (3) based on the α value of the svd analysis computed post hoc (extended data fig. 15b,c). all three groupings yielded similar results and similar conclusions from the decoder simulations.population vector (pv) decoder: the classical pv decoder54,55 was adapted to the case in which the stimulus space (that is, the environment) is not circular, and in which neurons can represent more than one location and distance. in each trial, we computed the following sum over the n neurons:the decoded location was then taken as the one that maximizes \({a}_{{\rm{pv}}}({x}_{d},{x}_{p}| \{{{\rm{n}}}_{i}\})\).our results are distinct from previous reports. (1) two studies tested how brief switches in the environment affect hippocampal activity56,57: these studies used non-ethological manipulations such as teleportation56 or rotating-platform57, whereas here we focused on natural behavioural switches. moreover, these two studies56,57 reported switching between two position maps, whereas here we found switching from position representation to distance-by-position representation. furthermore, both studies found that different place cells encode the two different position maps at different time points, whereas in our data, the same cells encoded conjunctively distance by position at the same time. (2) our results are also different from studies that examined hippocampal spatial representation in response to objects that were moved within the arena between trials, but remained stationary within a trial and, therefore, did not evoke a behavioural switch15,16. they found neurons that exhibited spatial tuning either with respect to the room or to object coordinates, but not to both conjunctively, whereas, in our data, the same cells encoded conjunctively distance by position at the same time. (3) our results are fundamentally different from classical remapping studies58,59, in which the hippocampus exhibits different position maps when the animal explores different environments in two different sessions. in such studies, there is no behavioural switch at all, because it typically takes a very long time (timescales of minutes) to transfer the animal between the different sessions and, therefore, such studies are not designed to examine rapid behavioural and neuronal switches, as we did here (with timescales as fast as ~100 ms). (4) our results are also different from our previous findings of encoding of distance to a stationary goal19, as here we focused on representation of a moving conspecific, which required a very rapid switch of attention, in contrast to the previous study. (5) finally, our results also differ fundamentally from our previous study, which found ca1 neurons that represent the position of another bat when the recorded bat is stationary60, as here we did not find ca1 neurons that encode the position of the other bat (extended data fig. 8). this difference may stem from task requirements—in the previous study60, it was behaviourally important to represent the other bat’s position, whereas here it was important to represent the interbat distance in the context of collision avoidance; we suggest that these major differences in behavioural demands were reflected in the hippocampal neural codes.our results showing a non-separable neural code may reflect the non-separable aspect of natural behaviour in the wild. navigation behaviours typically depend on the location where they happen, for example, commuting in one location versus foraging in another location61. this non-separability of behaviour was demonstrated also for collision-avoidance behaviours, for example, in bats that avoid wind turbines differently based on their location62, or in social-foraging bats, which respond differently to their conspecifics at different locations63. we speculate that the hippocampal system evolved to support (together with other brain areas) the animal’s ability to perform these challenging location-dependent behaviours. as a consequence, we suggest that the non-separable code that we found in the hippocampus of wild-born bats—a code that we showed is more efficient when considering 2d decoding of position by distance—is particularly suitable to guide such non-separable behaviours in the wild. by contrast, a separable neural code might be more suitable in other brain areas, such as inferior temporal cortex, in which an invariant and separable representation of objects is needed (for example, classifying a cat versus a dog irrespective of position). indeed, a largely separable neuronal code was demonstrated experimentally in the inferior temporal cortex, and was shown to be beneficial for position-invariant object classification64,65.further information on research design is available in the nature research reporting summary linked to this article.the data generated and analysed in the current study are available from the corresponding authors on reasonable request. source data are provided with this paper.the matlab code generated for the current study is available from the corresponding authors on reasonable request.simmons, j. a., fenton, m. b. & o’farrell, m. j. echolocation and pursuit of prey by bats. science 203, 16–21 (1979).ads cas pubmed article google scholar ulanovsky, n. & moss, c. f. what the bat’s voice tells the bat’s brain. proc. natl acad. sci. usa 105, 8491–8498 (2008).ads cas pubmed pubmed central article google scholar petrites, a. e., eng, o. s., mowlds, d. s., simmons, j. a. & delong, c. m. interpulse interval modulation by echolocating big brown bats (eptesicus fuscus) in different densities of obstacle clutter. j. comp. physiol. a 195, 603–617 (2009).article google scholar surlykke, a., ghose, k. & moss, c. f. acoustic scanning of natural scenes by echolocation in the big brown bat, eptesicus fuscus. j. exp. biol. 212, 1011–1020 (2009).pubmed pubmed central article google scholar yovel, y., falk, b., moss, c. f. & ulanovsky, n. optimal localization by pointing off axis. science 327, 701–704 (2010).ads cas pubmed article google scholar yovel, y., geva-sagiv, m. & ulanovsky, n. click-based echolocation in bats: not so primitive after all. j. comp. physiol. a 197, 515–530 (2011).article google scholar fujioka, e. et al. rapid shifts of sonar attention by pipistrellus abramus during natural hunting for multiple prey. j. acoust. soc. am. 136, 3389–3400 (2014).ads pubmed article google scholar sandig, s., schnitzler, h.-u. & denzinger, a. echolocation behaviour of the big brown bat (eptesicus fuscus) in an obstacle avoidance task of increasing difficulty. j. exp. biol. 217, 2876–2884 (2014).pubmed google scholar kothari, n. b., wohlgemuth, m. j. & moss, c. f. dynamic representation of 3d auditory space in the midbrain of the free-flying echolocating bat. elife 7, e29053 (2018).pubmed pubmed central article google scholar o’keefe, j. & dostrovsky, j. the hippocampus as a spatial map. preliminary evidence from unit activity in the freely-moving rat. brain res. 34, 171–175 (1971).pubmed article google scholar wilson, m. a. & mcnaughton, b. l. dynamics of the hippocampal ensemble code for space. science 261, 1055–1058 (1993).ads cas pubmed article google scholar leutgeb, s. et al. independent codes for spatial and episodic memory in hippocampal neuronal ensembles. science 309, 619–623 (2005).ads cas pubmed article google scholar ulanovsky, n. & moss, c. f. hippocampal cellular and network activity in freely moving echolocating bats. nat. neurosci. 10, 224–233 (2007).cas pubmed article google scholar eliav, t. et al. multiscale representation of very large environments in the hippocampus of flying bats. science 372, eabg4020 (2021).cas pubmed article google scholar gothard, k. m., skaggs, w. e. & mcnaughton, b. l. dynamics of mismatch correction in the hippocampal ensemble code for space: interaction between path integration and environmental cues. j. neurosci. 16, 8027–8040 (1996).cas pubmed pubmed central article google scholar gothard, k. m., skaggs, w. e., moore, k. m. & mcnaughton, b. l. binding of hippocampal ca1 neural activity to multiple reference frames in a landmark-based navigation task. j. neurosci. 16, 823–835 (1996).cas pubmed pubmed central article google scholar georges-françois, p., rolls, e. t. & robertson, r. g. spatial view cells in the primate hippocampus: allocentric view not head direction or eye position or place. cereb. cortex 9, 197–212 (1999).pubmed article google scholar lever, c., burton, s., jeewajee, a., o’keefe, j. & burgess, n. boundary vector cells in the subiculum of the hippocampal formation. j. neurosci. 29, 9771–9777 (2009).cas pubmed pubmed central article google scholar sarel, a., finkelstein, a., las, l. & ulanovsky, n. vectorial representation of spatial goals in the hippocampus of bats. science 355, 176–180 (2017).ads cas pubmed article google scholar wang, c. et al. egocentric coding of external items in the lateral entorhinal cortex. science 362, 945–949 (2018).ads cas pubmed pubmed central article google scholar høydal, o. a., skytøen, e. r., andersson, s. o., moser, m.-b. & moser, e. i. object-vector coding in the medial entorhinal cortex. nature 568, 400–404 (2019).ads pubmed article cas google scholar lachance, p. a., todd, t. p. & taube, j. s. a sense of space in postrhinal cortex. science 365, aax4192 (2019).ads article cas google scholar poulter, s., lee, s. a., dachtler, j., wills, t. j. & lever, c. vector trace cells in the subiculum of the hippocampal formation. nat. neurosci. 24, 266–275 (2021).cas pubmed article google scholar pastalkova, e., itskov, v., amarasingham, a. & buzsáki, g. internally generated cell assembly sequences in the rat hippocampus. science 321, 1322–1327 (2008).ads cas pubmed pubmed central article google scholar harvey, c. d., coen, p. & tank, d. w. choice-specific sequences in parietal cortex during a virtual-navigation decision task. nature 484, 62–68 (2012).ads cas pubmed pubmed central article google scholar aronov, d., nevers, r. & tank, d. w. mapping of a non-spatial dimension by the hippocampal-entorhinal circuit. nature 543, 719–722 (2017).ads cas pubmed pubmed central article google scholar lee, w. j. et al. tongue-driven sonar beam steering by a lingual-echolocating fruit bat. plos biol. 15, e2003148 (2017).pubmed pubmed central article cas google scholar lee, d., lin, b. j. & lee, a. k. hippocampal place fields emerge upon single-cell manipulation of excitability during behavior. science 337, 849–853 (2012).ads cas pubmed article google scholar geva-sagiv, m., las, l., yovel, y. & ulanovsky, n. spatial cognition in bats and rats: from sensory acquisition to multiscale maps and navigation. nat. rev. neurosci. 16, 94–108 (2015).cas pubmed article google scholar danilovich, s. & yovel, y. integrating vision and echolocation for navigation and perception in bats. sci. adv. 5, eaaw6503 (2019).ads cas pubmed pubmed central article google scholar depireux, d. a., simon, j. z., klein, d. j. & shamma, s. a. spectro-temporal response field characterization with dynamic ripples in ferret primary auditory cortex. j. neurophysiol. 85, 1220–1234 (2001).cas pubmed article google scholar ahrens, m. b., paninski, l. & sahani, m. inferring input nonlinearities in neural encoding models. network 19, 35–67 (2008).mathscinet pubmed article google scholar mazer, j. a., vinje, w. e., mcdermott, j., schiller, p. h. & gallant, j. l. spatial frequency and orientation tuning dynamics in area v1. proc. natl acad. sci. usa 99, 1645–1650 (2002).ads cas pubmed pubmed central article google scholar priebe, n. j., lisberger, s. g. & movshon, j. a. tuning for spatiotemporal frequency and speed in directionally selective neurons of macaque striate cortex. j. neurosci. 26, 2941–2950 (2006).cas pubmed pubmed central article google scholar gerlei, k. et al. grid cells are modulated by local head direction. nat. commun. 11, 4228 (2020).ads cas pubmed pubmed central article google scholar sasaki, r., angelaki, d. e. & deangelis, g. c. dissociation of self-motion and object motion by linear population decoding that approximates marginalization. j. neurosci. 37, 11204–11219 (2017).cas pubmed pubmed central article google scholar finkelstein, a., ulanovsky, n., tsodyks, m. & aljadeff, j. optimal dynamic coding by mixed-dimensionality neurons in the head-direction system of bats. nat. commun. 9, 3590 (2018).ads pubmed pubmed central article cas google scholar neuweiler, g. the biology of bats (oxford univ. press, 2000).schnitzler, h.-u., moss, c. f. & denzinger, a. from spatial orientation to food acquisition in echolocating bats. trends ecol. evol. 18, 386–394 (2003).article google scholar hiryu, s., shiori, y., hosokawa, t., riquimaroux, h. & watanabe, y. on-board telemetry of emitted sounds from free-flying bats: compensation for velocity and distance stabilizes echo frequency and amplitude. j. comp. physiol. a 194, 841–851 (2008).article google scholar moss, c. f. & surlykke, a. probing the natural scene by echolocation in bats. front. behav. neurosci. 4, 33 (2010).pubmed pubmed central google scholar voigts, j., newman, j. p., wilson, m. a. & harnett, m. t. an easy-to-assemble, robust, and lightweight drive implant for chronic tetrode recordings in freely moving animals. j. neural eng. 17, 026044 (2020).ads pubmed pubmed central article google scholar tuval, a., las, l. & shilo-benjamini, y. evaluation of injectable anaesthesia with five medetomidine-midazolam based combinations in egyptian fruit bats (rousettus aegyptiacus). lab. anim. 52, 515–525 (2018).cas pubmed article google scholar mcnaughton, b. l., barnes, c. a. & o’keefe, j. the contributions of position, direction, and velocity to single unit activity in the hippocampus of freely-moving rats. exp. brain res. 52, 41–49 (1983).cas pubmed article google scholar geva-sagiv, m., romani, s., las, l. & ulanovsky, n. hippocampal global remapping for different sensory modalities in flying bats. nat. neurosci. 19, 952–958 (2016).cas pubmed article google scholar wiener, s. i., paul, c. a. & eichenbaum, h. spatial and behavioral correlates of hippocampal neuronal activity. j. neurosci. 9, 2737–2763 (1989).cas pubmed pubmed central article google scholar kropff, e., carmichael, j. e., moser, m.-b. & moser, e. i. speed cells in the medial entorhinal cortex. nature 523, 419–424 (2015).ads cas pubmed article google scholar gois, z. & tort, a. b. l. characterizing speed cells in the rat hippocampus. cell rep. 25, 1872–1884 (2018).cas pubmed article google scholar maris, e. & oostenveld, r. nonparametric statistical testing of eeg- and meg-data. j. neurosci. methods 164, 177–190 (2007).pubmed article google scholar groppe, d. m., urbach, t. p. & kutas, m. mass univariate analysis of event-related brain potentials/fields ii: simulation studies. psychophysiology 48, 1726–1737 (2011).pubmed pubmed central article google scholar zhang, k., ginzburg, i., mcnaughton, b. l. & sejnowski, t. j. interpreting neuronal population activity by reconstruction: unified framework with application to hippocampal place cells. j. neurophysiol. 79, 1017–1044 (1998).cas pubmed article google scholar smolyanskaya, a., ruff, d. a. & born, r. t. joint tuning for direction of motion and binocular disparity in macaque mt is largely separable. j. neurophysiol. 110, 2806–2816 (2013).pubmed pubmed central article google scholar owen, a. b. & perry, p. o. bi-cross-validation of the svd and the nonnegative matrix factorization. ann. appl. stat. 3, 564–594 (2009).mathscinet math article google scholar georgopoulos, a. p., schwartz, a. b. & kettner, r. e. neuronal population coding of movement direction. science 233, 1416–1419 (1986).ads cas pubmed article google scholar seung, h. s. & sompolinsky, h. simple models for reading neuronal population codes. proc. natl acad. sci. usa 90, 10749–10753 (1993).ads cas pubmed pubmed central article google scholar jezek, k., henriksen, e. j., treves, a., moser, e. i. & moser, m.-b. theta-paced flickering between place-cell maps in the hippocampus. nature 478, 246–249 (2011).ads cas pubmed article google scholar kelemen, e. & fenton, a. a. dynamic grouping of hippocampal neural activity during cognitive control of two spatial frames. plos biol. 8, e1000403 (2010).pubmed pubmed central article cas google scholar jeffery, k. j., gilbert, a., burton, s. & strudwick, a. preserved performance in a hippocampal-dependent spatial task despite complete place cell remapping. hippocampus 13, 175–189 (2003).pubmed article google scholar colgin, l. l., moser, e. i. & moser, m.-b. understanding memory through hippocampal remapping. trends neurosci. 31, 469–477 (2008).cas pubmed article google scholar omer, d. b., maimon, s. r., las, l. & ulanovsky, n. social place-cells in the bat hippocampus. science 359, 218–224 (2018).ads cas pubmed article google scholar goldshtein, a. et al. reinforcement learning enables resource partitioning in foraging bats. curr. biol. 30, 4096–4102 (2020).cas pubmed pubmed central article google scholar reusch, c., lozar, m., kramer-schadt, s. & voigt, c. c. coastal onshore wind turbines lead to habitat loss for bats in northern germany. j. environ. manage. 310, 114715 (2022).pubmed article google scholar cvikel, n. et al. bats aggregate to improve prey search but might be impaired when their density becomes too high. curr. biol. 25, 206–211 (2015).cas pubmed article google scholar li, n., cox, d. d., zoccolan, d. & dicarlo, j. j. what response properties do individual neurons need to underlie position and clutter invariant object recognition? j. neurophysiol. 102, 360–376 (2009).pubmed pubmed central article google scholar rust, n. c. & dicarlo, j. j. selectivity and tolerance (invariance) both increase as visual information propagates from cortical area v4 to it. j. neurosci. 30, 12978–12995 (2010).cas pubmed pubmed central article google scholar stewart, s., jeewajee, a., wills, t. j., burgess, n. & lever, c. boundary coding in the rat subiculum. philos. trans. r. soc. lond. b 369, 20120514 (2014).article google scholar poulter, s., hartley, t. & lever, c. the neurobiology of mammalian navigation. curr. biol. 28, r1023–r1042 (2018).cas pubmed article google scholar hinman, j. r., chapman, g. w. & hasselmo, m. e. neuronal representation of environmental boundaries in egocentric coordinates. nat. commun. 10, 2772 (2019).ads pubmed pubmed central article cas google scholar alexander, a. s. et al. egocentric boundary vector tuning of the retrosplenial cortex. sci. adv. 6, eaaz2322 (2020).ads pubmed pubmed central article google scholar hafting, t., fyhn, m., molden, s., moser, m.-b. & moser, e. i. microstructure of a spatial map in the entorhinal cortex. nature 436, 801–806 (2005).ads cas pubmed article google scholar yartsev, m. m., witter, m. p. & ulanovsky, n. grid cells without theta oscillations in the entorhinal cortex of bats. nature 479, 103–107 (2011).ads cas pubmed article google scholar schmitzer-torbert, n., jackson, j., henze, d., harris, k. & redish, a. d. quantitative measures of cluster quality for use in extracellular recordings. neuroscience 131, 1–11 (2005).cas pubmed article google scholar andersen, p., morris, r. g. m., amaral, d. g., bliss, t. v. & o’keefe, j. the hippocampus book (oxford univ. press, 2007).basu, j. et al. gating of hippocampal activity, plasticity, and memory by entorhinal cortex long-range inhibition. science 351, aaa5694 (2016).pubmed pubmed central article cas google scholar o’neill, w. e. & suga, n. target range-sensitive neurons in the auditory cortex of the mustache bat. science 203, 69–73 (1979).ads pubmed article google scholar dear, s. p., simmons, j. a. & fritz, j. a possible neuronal basis for representation of acoustic scenes in auditory cortex of the big brown bat. nature 364, 620–623 (1993).ads cas pubmed article google scholar knierim, j. j., neunuebel, j. p. & deshmukh, s. s. functional correlates of the lateral and medial entorhinal cortex: objects, path integration and local-global reference frames. philos. trans. r. soc. lond. b 369, 20130369 (2014).article google scholar poirazi, p., brannon, t. & mel, b. w. pyramidal neuron as two-layer neural network. neuron 37, 989–999 (2003).cas pubmed article google scholar poirazi, p., brannon, t. & mel, b. w. arithmetic of subthreshold synaptic summation in a model ca1 pyramidal cell. neuron 37, 977–987 (2003).cas pubmed article google scholar branco, t. & häusser, m. synaptic integration gradients in single cortical pyramidal cell dendrites. neuron 69, 885–892 (2011).cas pubmed pubmed central article google scholar schmidt-hieber, c. et al. active dendritic integration as a mechanism for robust and precise grid cell firing. nat. neurosci. 20, 1114–1121 (2017).cas pubmed pubmed central article google scholar hargreaves, e. l., rao, g., lee, i. & knierim, j. j. major dissociation between medial and lateral entorhinal input to dorsal hippocampus. science 308, 1792–1794 (2005).ads cas pubmed article google scholar download referenceswe thank d. derdikman, c. f. moss, t. reitich-stolero, p. patil, d. deitsch, t. eliav, g. ginosar, s. ray, s. r. maimon and i. yona for comments on the manuscript; e. solomon, s. futerman, i. shulman, b. pevzner, k. dor, s. kodenzik, c. cohen, a. shalev, n. raish, a. zayarni and l. hartman for bat training; a. tuval for veterinary support; c. ra’anan and r. eilam for histology; b. pasmantirer and g. ankaoua for mechanical designs; and g. brodsky for graphics. n.u. is the incumbent of the barbara and morris levinson professorial chair in brain research. this study was supported by research grants from the european research council (erc-cog, natural_bat_nav) to n.u., the deutsche forschungsgemeinschaft (dfg, sfb 1372) to n.u., the national institutes of health (nih r01, ns121413) to n.u. and l.l., the israel science foundation (isf 1920/18) to n.u. and l.l., and a crcns collaborative grant to n.u., l.l. and j.a. (n.u. and l.l. were funded by bsf 2020806, and j.a. was funded by doe de-sc0022042); a research grant from y. and j. bronicki; and the andré deloro prize for scientific research and the kimmel award for innovative investigation to n.u. a.s. was supported by a boehringer ingelheim fonds phd fellowship, and by the naamat-idelson excellence fellowship for phd students.these authors contributed equally: ayelet sarel, shaked palgi, dan blumdepartment of brain sciences, weizmann institute of science, rehovot, israelayelet sarel, shaked palgi, dan blum, johnatan aljadeff, liora las & nachum ulanovskydepartment of neurobiology, university of california, san diego, ca, usajohnatan aljadeffyou can also search for this author in pubmed google scholaryou can also search for this author in pubmed google scholaryou can also search for this author in pubmed google scholaryou can also search for this author in pubmed google scholaryou can also search for this author in pubmed google scholaryou can also search for this author in pubmed google scholara.s., d.b., l.l. and n.u. conceived and designed the experiments, with contributions from s.p.; a.s., s.p. and d.b. conducted the experiments, with contributions from l.l.; a.s. and s.p. analysed the experimental data, with contributions from d.b. and j.a.; l.l. and n.u. guided the data analysis. j.a. conducted the theoretical modelling and simulations. a.s. and n.u. wrote the first draft of the manuscript, with major input from l.l. and s.p. all of the authors contributed to writing and editing the manuscript. n.u. supervised the project.correspondence to liora las or nachum ulanovsky.the authors declare no competing interests.nature thanks colin lever and the other, anonymous, reviewer(s) for their contribution to the peer review of this work.publisher’s note springer nature remains neutral with regard to jurisdictional claims in published maps and institutional affiliations.a–d, example of one experimental session: same experimental session as shown in fig. 1b. a, the positions of the two bats along the entire experimental session. time in session runs from top-left to bottom-right; scale bar, 1 min. blue and orange lines: positions of the recorded bat and other bat, respectively. cross-over events are marked with pink circles, and cross-over flights (window of ±40-m of interbat distance around the cross-over event) are marked with pink rectangles. solo flights are marked with grey rectangles. b, distribution of behavioural coverage along the tunnel: solo (left) and cross-overs (right), plotted separately for the two flight-directions (dark and light-coloured, stacked). light grey vertical rectangles at the edges of both panels: areas where cross-overs were not analysed (methods); we also note that there were less cross-overs in the bins adjacent to the grey rectangles (see also panels e and g). c, position versus time within the session (time from first to last cross-over), for all the cross-over events in the session shown in a. the cross-over events occurred quite uniformly along the entire tunnel (y axis), and were pseudo-randomly distributed over time (x axis; direction 1, spearman correlation of position versus time: ρ = 0.02, p = 0.90, n = 52 cross-overs; direction 2, spearman correlation: ρ = −0.08, p = 0.57, n = 52 cross-overs). d, position versus time within the session for all the solo flights (black) and all the cross-over flights (pink), for one flight-direction, in the same session shown in panels a–c. note that cross-over flights were intermingled with solo flights, which created holes in the solo behaviour, where cross-over flights occurred (see examples of such holes also in the solo rasters in fig. 2a and extended data fig. 3c). other reasons for holes in the solo data could be u-turns (which were removed from the analysis) or tracking flights (which were analysed separately in extended data fig. 9). e–f, additional example sessions, one session per bat. for each session the upper panels (e) are plotted as in b, and the lower panels (f) are plotted as in c. indicated are the spearman correlations of the cross-over positions versus the time of the cross-overs within the session. g–i, population summaries of behaviour for all the experimental sessions of each bat separately (columns 1–4) and all bats together (column 5). g, distribution of cross-over positions for all sessions × directions (rows) – demonstrating relatively uniform distribution of cross-overs along the tunnel, with no strong behavioural biases (in most sessions). each row is normalized to its maximal value. h, distribution of sparsity, where the sparsity for each session was computed over the histogram of cross-overs – i.e. sparsity of the rows of the matrix plotted in panel g (\({\rm{sparsity}}={\left\langle {r}_{i}\right\rangle }^{2}/\left\langle {r}_{i}^{2}\right\rangle \), where ri are the values in each bin in the histogram). sparsity is bound between 0 and 1, with a value of 1 indicating uniform distribution. note that for most sessions the sparsity was relatively high (close to 1), indicating nearly-uniform distribution of cross-over events along the tunnel. i, distribution of spearman correlations between position of cross-overs and time of cross-overs, for all the sessions × directions (examples of these spearman correlations are shown in panels c,f). note that for most sessions there was low correlation between time and the position of the cross-overs – indicating a relatively uniform behaviour along the session, with no systematic trends over time.a, audio signals (filtered 10–40 khz) for the recorded bat (blue) and the other bat (orange), at short interbat distances during a cross-over (dashed pink line indicates the cross-over event = distance 0). the two signals were recorded through ultrasonic microphones placed on the head of each bat (methods). blue dots mark clicks detected via the microphone on the recorded bat. bottom filled orange dots mark clicks detected via the microphone on the other bat. top empty orange dots (shifted in time) mark the time at which the bottom (filled) orange click of the other bat was expected to be recorded through the microphone on the recorded bat, given the distance between the two bats (see also black arrows; this ‘expected time shift’ was computed as the distance between the bats divided by the speed of sound). note that indeed above each black arrow there is a very small click in the blue audio trace of the recoded bat – which corresponds to clicks produced by the other bat (these small signals were observed only when the bats were very close to one another: ~3 m). therefore, by excluding such small clicks that appeared around the expected time (as marked here by the black arrows), we could ensure that none of the detected clicks on the recorded bat (blue) has originated from the other bat’s echolocation (orange) – and vice versa (see methods). b, distribution of click-rates for solo flights (black) and for cross-over flights in two different distance ranges: pink, computed for interbat distance between –15 m to 0 m, and grey, computed for interbat distance between −40 m to −30 m (a large distance, where the bats behaved similarly to solo). note that the pink distribution is highly separated both from the grey distribution and from the black distribution (kolmogorov-smirnov test: p < 10−300 for both comparisons; wilcoxon rank sum test: p < 10−300 for both) – suggesting that the bats were in different behavioural modes during solo versus cross-overs. in particular, note that during solo flights, the bats almost never increased the click-rate as high as during the cross-over encounters. c, population average click-rate (top) and click-amplitude (bottom), during cross-over flights (pink lines) and solo flights (black error bars). left 5 panels – individual bats: the black error bar and pink shading represent mean ± s.d for solo and cross-over, respectively (bat 2299 [same bat as in fig. 1e]: n = 962 cross-over flights and n = 107,418 solo time bins; bat 2336: n = 254 cross-over flights and n = 26,783 solo time bins; bat 2389: n = 108 cross-over flights and n = 9,831 solo time bins; bat 2331: n = 1,217 cross-over flights and n = 116,737 solo time bins; bat 2387: n = 106 cross-over flights and n = 10,529 solo time bins; the time bins for solo flight were adjusted to match the bins in cross-over tuning; bat 30 was not analysed here because its audio was recorded using a different audio-logger device and therefore its click-amplitude was not comparable with the other bats). rightmost panel – population average click-rate (top) and amplitude (bottom; n = 5 bats; each bat was normalized here to the mean amplitude during cross-over): shown are the averages for individual bats during cross-overs (pink curves) and grand-average over all bats (purple curve) – and the averages during solo (dots; individual bats are shown by the grey dots, population average is the black dot). d, 2d click-rate map plotted as a function of the interbat distance (x-axis) and position (y-axis) – shown for two example sessions from two different bats (see population of bat 2299 in fig. 1f). colour-coded from zero (blue) to maximal click-rate (red; value indicated): see colour-bar. note that the click-rate increased at approximately −20 metres before cross-over, along all the positions in the tunnel (vertical red band). e, schematic of the tunnel, showing the tunnel’s x coordinate (long axis) and y coordinate (lateral axis); the accuracy of the z measurement was lower than x,y, hence we did not analyse it. f, echolocation click-rate map (pooled over all bats) plotted for lateral interbat distance in the y-axis of the tunnel (distancey = the lateral offset between the two bats) versus the interbat distance in the x-axis of the tunnel (distancex). note that the click-rate was higher when the distance between the bats was low in both axes – i.e. when the bats were on a tight collision-course (notice the red hotspot at (0,0) in this map). g, median click-rate per-flight for regular cross-over flights (left, n = 948 flights: all the regular flights of bat 2299), compared to cross-over flights where the bats nearly collided (right, n = 14 flights). these actual near-collisions were identified as flights in which at short distancex between the bats (less than ±0.25 m) they also flew-by at short distancey (less than ±0.25 m), and reduced their speed within this distance window to < 4 m/s (a highly-unusual slowing-down, akin to a push on the brakes). in those rare near-collision flights, the bats exhibited significantly lower click-rate (permutation test on the difference between the means of the two groups: p = 0.0001; wilcoxon rank sum test: p = 0.006), and sometimes they did not echolocate at all – suggesting that lapse of attention (low click-rate or absence of clicks) leads to near-collisions or full collisions. note that since these braking events were such rare events (n=14), their contribution to the heat-map in panel f was small and was averaged out. box-and-whisker plots show the median (horizontal line), 25–75% range (box) and 10–90% range (whiskers).a, examples of coronal sections through dorsal hippocampus of two of our recorded bats (left, bat 2336; middle and right, bat 2299). red arrowheads mark holes due to a tetrode-track (left), or electrolytic lesions in ca1 at the end of tetrode-tracks (middle and right: two different tetrodes). these examples illustrate the large proximo-distal anatomical span of our recording-sites in dorsal ca1. scale bars, 500 µm. similar reconstruction of tetrode-tracks was performed for all the tetrodes in all the 4 bats. b, percentage of pyramidal distance-modulated neurons (defined either in 1d or 2d, see fig. 3g, thick black line) in proximal tetrodes (red) versus distal tetrodes (blue), for bats 2336 and 2299 (the two bats for which we had large proximo-distal spread of the tetrodes). for each bat we separated the tetrodes into the proximal tetrodes versus the distal tetrodes of the tetrode-bundle (excluding ambiguously-located tetrodes in the centre of the bundle). there was no relation between the proximal/distal location of the tetrode in ca1 and the percentage of distance-tuned neurons (comparing proximal versus distal: bat 2336: log odds ratio test: p = 0.654, fisher’s exact test: p = 0.673, nproximal = 31 cells, ndistal = 70 cells; bat 2299: log odds ratio test: p = 0.102, fisher’s exact test: p = 0.116, nproximal = 114 cells, ndistal = 62 cells; fdr-corrected for multiple comparisons for 2 bats). c, examples of 12 place cells, during solo flights. top, position tuning-curves (firing rate maps). significant place fields are marked by red dots above the peak; arrows indicate flight direction. bottom, spike rasters: raw positional data (grey) with spikes overlaid (black dots). spatial information (si, in bits/spike) is indicated above each cell. d, distribution of the number of fields per direction for all the significant place cells (n = 613 cells × directions). e, distribution of place-field sizes for all the significant place cells (n = 1,856 place fields). f, distribution of spatial information for all the place cells (n = 613 cells × directions). g, distribution of pearson correlations between position tuning-curves for the two flight-directions of the same cell (black line) or between the two directions across different cells (grey bars: cell shuffling; kolmogorov-smirnov test of data versus shuffles: p = 0.16; n = 251 cells in the black distribution – computed only for cells where both directions were significantly place-tuned). overall, our data for place fields in this large-scale environment is similar to what we found before14: we observed here multiple place fields per neuron, with a variety of spatial scales per neuron, i.e. different fields of the same neuron exhibited highly-varying sizes (multiscale code). we note that there were some small numerical differences in place-field numbers and place-field sizes, as compared to ref. 14, because: (i) we used here a shorter portion of the tunnel (135 m) than in our previous work (200 m)14; and (ii) we modified here the parameters used to compute the position tuning-curves (we used a larger bin size and larger smoothing-kernel, since we had here less solo data than in ref. 14).a, population summary for individual bats (plotted similar to fig. 2b): z-scored tuning-curves plotted separately for pyramidal neurons (top) and interneurons (bottom), sorted by preferred distance (the distance of the peak of the distance-tuning). b, stability of the 1d distance tuning: shown are z-scored tuning-curves that were constructed based on odd flights (left) or even flights (right), separately for pyramidal neurons (top; n = 125) and interneurons (bottom; n = 29); sorted by the preferred distance (peak of the distance-tuning) in the odd-flights data (i.e., sorted according to the left panel). note that the tuning was stable and was preserved in even flights versus odd flights. c, z-scored distance tuning curves, where the z-scoring was done relative to the solo-projected on cross-over shuffle (see extended data fig. 5) for pyramidal neurons (top) and interneurons (bottom); sorted by the preferred distance (peak of the distance-tuning). colour limits were set from the minimum across all tuning curves to z = 10; the most strongly-responding neuron had z = 36.5, and the 90% percentile across the population was z = 15.7 – signifying very strong and significant distance responses. d–e, interbat distance and time to cross-over were highly correlated. d, raw data from a single session: time to cross-over (y-axis) versus interbat distance (x-axis). e, distribution of pearson correlations between time to cross-over and interbat distance, for all the recording sessions (n = 83 sessions). note that the range of correlations shown is from 0.99 to 1; mean pearson correlation is 0.9987. since both variables (time and distance) are highly correlated, we could not distinguish between time coding versus distance coding, and decided to perform all analyses as a function of distance (except fig. 3c, and extended data figs. 6k, 7d, 11e). f–g, interbat distance along the long axis of the tunnel (distancex) and the euclidean distance between the bats (distanceeuclidean), which takes into account also the lateral axis of the tunnel (y-axis in extended data fig. 2e). f, raw data from a single session (same session as in d): euclidean distance (y-axis) versus distancex (x-axis). these two distance-measures were highly correlated. inset, zoom-in on ±3m on both axes: there is high correlation in this range, too. note that the region around 0, in which there is a slight difference between the euclidean distance and distancex, is a very small region – and falls within one bin of our neuronal interbat distance analysis; therefore, plotting neuronal tuning curves using the euclidean distance would yield virtually identical results to plotting them using distancex as done in the paper. g, distribution of pearson correlations between the euclidean distance and distancex for all the recorded sessions (n = 83 sessions). note that the range of correlations shown is from 0.9999 to 1; mean pearson correlation is 0.99999. since both variables (distancex and euclidean distance) are highly correlated, we decided to focus in this study on distancex (distance along the tunnel) – to be consistent with the 1d position coding, which was also measured along the tunnel. h–k, comparisons of 1d distance tuning across flight-directions and across positive/negative distances. here we tested whether our neurons are tuned to absolute interbat distance in a similar manner regardless of flight-direction (flying east versus west) and regardless of the relative direction between the bats (flying towards or away from one another – we note that bats can sense the presence of another bat via their echolocation also behind them, as echolocation signals spread also backwards5,27). we expect that a ‘pure distance cell’ with a preferred distance of 20 m, for example, would fire symmetrically at two distances: ±20 m (i.e. would have a double peak in its distance tuning curve, at −20 m and at +20 m); and we also expect to find the same tuning in both flight directions (east and west) – i.e. overall we expect a 4-fold symmetry. alternatively, if the response of the neurons is not purely to distance, it suggests that there is a directional component to the tuning, which is similar to a vectorial signal. h, examples of 1d distance neurons (same neurons as in fig. 2a), showing the 1d distance tuning in the significant direction (pink; plotted also in fig. 2a) and in the other flight direction (blue-purple). pearson correlations of the distance tuning curves between the two flight-directions are indicated. i–k, population: various comparisons of pearson correlations between the 1d distance tuning-curve of a cell versus the other direction or versus flipped direction (pink); for control shown are the same comparisons across different cells (grey: cell shuffling). i, comparing distance tuning in the two different flight directions (flying east versus west). left: pyramidal cells (kolmogorov-smirnov test of data versus shuffles: p = 0.09, wilcoxon rank sum test: p = 0.08; n = 108 pyramidal cells that had at least one direction with significant distance modulation). right: interneurons (kolmogorov-smirnov test: p = 0.04, wilcoxon rank sum test: p = 0.003; n = 22 interneurons that had at least one direction with significant distance modulation). the higher correlations in interneurons suggest that interneurons are more likely to be direction-invariant distance cells, while pyramidal neurons fire differently depending on flight direction – as would be expected from a vectorial representation. notably, when we limited this analysis to include only neurons that had significant distance-tuning in both flight directions, we found that those cells had a higher correlation values between the distance-tuning of both flight directions, as compared to the shuffle correlations across cells (pyramidal neurons: kolmogorov-smirnov test of data versus shuffles: p = 0.01, wilcoxon rank sum test: p = 0.01, n = 17 cells; interneurons: kolmogorov-smirnov test of data versus shuffles: p = 0.01, wilcoxon rank sum test: p = 2.49 × 10−3, n = 7 cells) – indicating that some neurons do encode distance invariant of flight direction. we note that the probability to exhibit significant distance tuning in both flight directions (pobserved distance-tuning both directions) was higher than expected from the null hypothesis of independence (pnull distance-tuning both directions = pdistance-tuning dir 1 × pdistance-tuning dir 2) – both for pyramidal cells (binomial test: p = 0.023) and for interneurons (binomial test: p = 7.81 × 10−5): this suggests that ca1 neurons have a propensity to exhibit distance tuning, which is expressed in both flight-directions. j, comparing pearson correlations between the distance-tuning in flight direction 1 and the flipped distance-tuning in flight direction 2. left: pyramidal cells (kolmogorov-smirnov test of data versus shuffles: p = 0.13, wilcoxon rank sum test: p = 0.17; n = 108 pyramidal cells that had at least one direction with significant distance modulation). right: interneurons (kolmogorov-smirnov test: p = 0.84, wilcoxon rank sum test: p = 0.44; n = 22 interneurons that had at least one direction with significant distance modulation). k, comparing pearson correlation computed between negative distances and flipped positive distances (mirror image around zero-distance; this was aimed to test tuning symmetry when bats are flying toward each other compared with flying away). computed only for neurons that did not have a significant bin at zero distance (because such cases would exhibit by definition high correlations due to high mirror-symmetry). left: pyramidal cells (kolmogorov-smirnov test of data versus shuffles: p = 0.65, wilcoxon rank sum test: p = 1.00; n = 64 pyramidal cells). right: interneurons (kolmogorov-smirnov test: p = 0.02, wilcoxon rank sum test: p = 0.02; n = 14 interneurons). overall, the data in this figure suggest that the majority of distance-tuned neurons exhibited different distance-tuning for the two flight directions (east versus west), and different distance-tuning for the two relative directions between the bats (other bat in front or behind – i.e. flying towards or away). this suggests that our results reflect vectorial signals that have both a distance and a direction component. interestingly, the bat’s distance-tuned cells showed a mixture of enhanced and suppressed responses – akin to the behaviour of other types of vectorial cells in the hippocampal formation and surrounding regions, such as boundary-vector cells18,66,67,68,69. however, it is noteworthy that some of our cells did show higher correlations between flight directions (this was true for pyramidal cells with significant distance-tuning in both flight direction, and also for interneurons) – and thus some of these neurons could be regarded as direction-invariant distance-coding neurons.a, cartoon illustrating the solo projected on cross-over shuffling method (one of the two shuffling methods used throughout this study; see methods). this shuffling-method is aimed to compare the actual firing during cross-overs to the expected firing based on the solo data – in order to account for the prominent position-coding in the hippocampus. for each cross-over flight (panel a (i)) we looked for all the solo flights that occurred within the same position-range as the cross-over flight (panel a (ii); all turquoise-coloured solo flight epochs covered fully the same position range as the thick pink cross-over flight in panel a (i)). then we randomly chose 1 of these solo flights (panel a (ii): thick turquoise line), and linearly projected the spikes that occurred during this solo flight onto the cross-over flight data, to yield the projected interbat distance of each spike (panel a (iii); black dots on top of the turquoise flight). we repeated this process for all the cross-over flights, to create a full matrix that is based on combining behaviour taken from the cross-over data and neuronal responses taken from the solo data (panel a (iv)). this entire process (all four panels i–iv) was repeated 10,000 times, to create 10,000 shuffle matrices, each combining the cross-over behaviour with the cell’s position solo tuning and spiking-statistics – but without any explicit distance modulation. these 10,000 shuffle matrices (shuffle maps) served as a null hypothesis for how the cell should fire assuming it has no distance tuning. b, examples of significant 1d distance cells. shown for each cell: the 1d distance tuning-curve (pink line), tuning-curves of the ‘solo projected on cross-over’ shuffles (shaded grey – the shuffles from a), and tuning-curves of the rigid cross-over shuffles (shaded pink – this is the second type of shuffle that we used in this study: see methods). horizontal green lines denote significant enhancement bins, and horizontal brown line denotes significant suppression bins: significance was computed based on both types of shuffles (methods; we note that for enhancement-tuning, the cross-over shuffles were above the other type of shuffle, and vice versa for the suppression-tuning – because the cross-over shuffle preserves the number of spikes and thus reflects the average of the pink tuning-curve, which goes up in enhancement and down in suppression). c, examples of 2d distance-by-position firing maps of ‘solo projected on cross-over’ shuffles from three cells. leftmost column – the cell’s actual experimental data during cross-over: top left, tuning-curve for 1d distance; horizontal green/brown lines denote bins with significant enhancement/suppression. bottom left (main panel): firing rate map of position (y-axis) by interbat distance (x-axis). bottom right: position place tuning of the cell during solo flights (black) and during cross-over flights (pink). five rightmost columns – examples of five random shuffle maps for each neuron: bottom, 2d firing rate map of position (y-axis) by interbat distance (x-axis); top, the corresponding 1d distance tuning curve of the shuffled data. the y limits and colour-scale were held fixed for each cell, i.e. for all the panels of the same row (2d maps coloured from zero [blue] to the maximum value over all panels [red; value indicated for each map]). note that the 2d firing rate maps of the shuffles show horizontal stripes, representing the place fields, and there is no real distance modulation in these maps: the small modulations in the firing rate seen along the distance axis in these shuffles are caused by the somewhat non-uniform behavioural coverage and by the random spiking statistics. these two factors exist also in the cross-over data – and therefore these matrices serve as a ‘null hypothesis’ that controls both for behavioural coverage and for spiking statistics, reflecting how the cell would fire if it was not truly modulated by distance.a, rationale of analysis. shown is a schematic of the tunnel, depicting the tunnel’s x coordinate (long axis) and y coordinate (lateral axis); the accuracy of the z measurement was lower than x,y, hence we did not analyse it. in order to test whether the neuronal modulations found during cross-overs reflect genuine distance-tuning, which could not be explained by motor variables, we reasoned as follows: if a neuron is modulated by motor variables, then we expect to see the same movement-related modulation both during solo and during cross-over flights. we considered three types of movement variables: (i) speed – the speed computed over both axes of the tunnel (x and y together), where we aimed to control for changes in speed, such as slowing down. (ii) velocity y – velocity just in the y axis of the tunnel (lateral), aiming to control for lateral movements of the bat towards the side of the tunnel during cross-overs. (iii) speed y – the absolute velocity in the y axis (here lateral movement to the left or to the right are considered to be the same). b–c, profiles of the movement variables during cross-overs for an example session (b) and population pooled over all the sessions of all bats (n = 166 sessions × directions) (c). top: mean speed (pink) and velocity y (purple); shaded colours show the 5–95% percentile range. the lines in panel c-top represent individual means for each bat. inset, zoom on velocity y (purple) for the relevant velocity range. bottom: 2d speed maps as a function of interbat distance and position, for one flight direction; position here denotes the position along the x-axis of the tunnel (x position); maps are colour-coded from zero (blue) to maximal speed (red; see colour-bar). note that speed-changes were rather small (very small colour-changes), and were distributed quite uniformly along the tunnel (see vertical red band in c). d–f, examples of tuning-curves to movement variables for 1d distance cells: tuning to speed (d), velocity y (e) and speed y (f). for each cell: top, tuning curves for movement variables during solo (black) and during cross-over (pink). bottom, linear slope fitted to the tuning-curve during solo (left; black line) and to the tuning-curve during cross-over (right; pink line), together with the slopes fitted to the shuffle tuning-curves (grey histograms, 10,000 shuffles). ‘*’ denotes significant tuning with p < 0.05, ‘**’ with p < 0.01; ‘ns’, non-significant. exact p-values: cell 288: psolo = 0.30, pcross-over = 0.46; cell 336: psolo = 0.20, pcross-over = 0.12; cell 48: psolo = 0.30, pcross-over = 0.009; cell 299: psolo = 0.003, pcross-over = 0.33; cell 19: psolo = 0.07, pcross-over = 0.01; cell 199: psolo = 0.003, pcross-over = 0.01; cell 58: psolo = 0.32, pcross-over = 0.37; cell 85: psolo = 0.23, pcross-over = 0.22; cell 324: psolo = 0.34, pcross-over = 0.003; cell 8: psolo = 0.16, pcross-over = 0.02; cell 155: psolo = 0.38, pcross-over = 0.003; cell 70: psolo = 0.33, pcross-over = 0.47. g-i, top: tables showing the number of 1d distance cells in each of the 3×3 possible combinations of speed modulations: positive/ns/negative modulation by speed or velocity during cross-over × positive/ns/negative modulation during solo. the numbers are shown for pyramidal neurons (n=125) and interneurons (n=29) – separately for speed (g), velocity y (h) and speed y (i). the schematic line-graphs in pink and black denote the combination of tunings that represent each rubric. green background represents modulation by speed that could not explain the neurons’ distance tuning: specifically, this occurs in cases in which the speed modulation during cross-over was not significant (dark green; examples in d-f that correspond to this case: cells 288, 336, 299, 58, 85, 70), or in cases where the speed modulation during cross-over was significant but was different than in solo (light green; examples in d-f: cells 48, 19, 324, 8, 155) – suggesting that these cells do not genuinely encode this motor variable. white background represents cells whose motor modulation might potentially explain the distance tuning: these are cases in which the speed modulation was significant and had the same slope-direction during solo and during cross-over (as in cell 199 in panel d). bottom, summary of the fraction of cells in each one of the three categories (three colours) taken from the table above. overall, the majority of the distance modulation of 1d distance cells could not be explained by motor variables – as indicated by the high percentage of cells in the two types of green areas of the pie-charts below. j, percentages of speed-tuned neurons (as defined above) for 1d distance cells (pink; 125 pyramidal neurons, top, and 29 interneurons, bottom) and cells that were not significantly tuned to 1d distance (grey; 568 pyramidal neurons, top, and 45 interneurons, bottom). note that there was no relation between the tendency of cells to exhibit significant 1d distance tuning, and their tendency to exhibit significant speed tuning (i.e., no difference in percentage of speed-tuned cells between the pink and grey bars). in other words, 1d distance-tuned cells were not more likely to be modulated by speed as compared with the rest of the population (χ2 test for pyramidal cells, p = 0.95; χ2 test for interneurons, p = 0.64). this again argues against the possibility that speed tuning can underlie the observed 1d distance tuning. k, flight velocity does not affect the rise-time of the neuronal responses during cross-over – supporting neuronal switch rather than multiplexing. shown is the distribution of contrast indices of the rise-time slope of the neuronal tuning for high versus low flight velocities: (rise time at faster flights – rise time at slower flights) / (rise time at faster flights + rise time at slower flights). here we tested whether the 2d distance-by-position tuning reflects static multiplexing of the two variables (hypothesis 3 in the main text). if the representation is static, then we expect that the rise-time of the response will depend on flight velocity; specifically, for higher flight velocities the cell would exhibit a steeper slope (shorter rise-time) when computing the time-to-crossover tuning. to this end, we defined the rise-time window as before, namely the time from the median of the shuffle to the first significant bin. we then divided the cross-over flights into two equally-sized groups, according to the flight velocity within the rise-time window (median bisection of velocity; we used here the combined velocity of the two bats, because this is the effective velocity at which the bats move along the distance axis). this yielded two sets of flights: flights with high velocity versus flights with low velocity in the relevant distances for each cell. we then computed the two tuning-curves as a function of time-to-cross-over separately for these two sets of flights. we computed the slope of these two tuning curves at the same rise-time window, and calculated the contrast index between the two slopes – and the histogram of these contrast indices is plotted here. as mentioned above, for a static tuning, the high-velocity tuning curves should yield higher slopes. however, we found that the contrast index of slopes for high velocity versus low velocity was not significantly different from zero (t-test: t = 0.84, p = 0.41; wilcoxon sign rank test: p = 0.43; we included here all the n = 120 neurons with 1d distance tuning that had more than 10 cross-over flights and more than 30 spikes for each of the two flight groups [low-velocity and high-velocity]). further, there was no correlation between the difference in velocities (quantified via the contrast index between the flight velocities) and the difference in the tuning slopes (contrast index of slopes) (the pearson correlation between the two was: r = −0.11, p = 0.25; spearman correlation: r = −0.13, p = 0.15; n = 120). since we found here that there was no relation between the flight velocity and the rise time, this argues against the hypothesis of a multiplexed code. by contrast, for a neuronal switch (hypothesis 4 in the main text) we expected that the switch-time will have a fixed duration, irrespective of velocity – as we found here. thus, these results are more consistent with a neuronal switch than with multiplexing.all the data included in this figure are taken from bat 2299, in which audio was recorded simultaneously with neurons. a–d, control for sensory or motor responses to individual clicks. to test whether the neuronal modulations found during cross-overs could be explained by sensory or motor responses to clicks, we reasoned as follows: during cross-overs there is a strong behavioural coupling between interbat distance and increase in click-rate (fig. 1d–f), and thus it is hard to disentangle these variables during cross-overs and reveal the underlying signal driving the neuron. since during solo the bats also emit echolocation calls (albeit at lower rates compared with cross-overs: fig. 1e, extended data fig. 2b), we can test the neuronal response to echolocation clicks during solo, where they are not coupled with the cross-over context. if a cell was not modulated by echolocation clicks during solo, it strongly suggests that also during cross-overs this cell was not modulated by pure sensory or motor responses to clicks. a, five examples of 1d distance cells. for each cell: top, echolocation behaviour: mean click-rate as a function of interbat distance (blue). the scale-bar in the rightmost cell shows the interbat distance that correspond to 400 ms, which is the time-duration of the panels in the third row (see below). middle, 1d distance tuning curve (during cross-over; pink); horizontal green line denotes significantly enhanced bins. correlation values above each cell correspond to the pearson correlation between the click-rate (first row) and the distance tuning curve of the cell (second row). bottom, click-triggered firing rate during solo (black), and shuffles (grey); nclicks denotes the number of echolocation clicks during solo (which were used to compute the click-triggered firing rate). we focused on a time window of ±200 ms, since this time-scale allows capturing most of the classical motor or sensory responses. areas with significant enhancement or suppression are marked in the bottom panel by green or brown lines, respectively. note that cells 34, 59 and 19 showed significant modulation of the 1d distance tuning (middle panels) but showed no significant response around the echolocation-clicks during solo (bottom panels). overall, 70.7% of the cells (n = 29) did not show any significant responses to echolocation clicks. b, distribution of pearson correlations between the click-rate and firing-rate tuning curves (correlations between upper panels in a and middle panels in a; n = 41 cells × directions). since pure sensory and motor responses in bats are known to have short timescales on the order of tens of milliseconds, we expect that a neuron which responds purely to clicks will follow faithfully the click-rate; therefore, its distance tuning will show a strong positive correlation with the click-rate (or negative correlation – depending on the sign of the response). however, the correlations were broadly distributed around zero, with many cells showing low and non-significant correlations (grey lines denote the significance threshold) – suggesting that the distance tuning of many cells cannot be explained by direct sensory or motor responses to clicks. c, percentages of three sub-populations of 1d distance cells recorded in bat 2299: (i) neurons that were not locked significantly to echolocation clicks during solo (dark green, 70.7% of the cells, n = 29 neurons; i.e. no significant responses in a-bottom: for example, see the three leftmost neurons in the bottom-most panel in a: cells 34, 59, 19). (ii) neurons that showed significant locking to echolocation clicks during solo (i.e. significant response in the bottom-most panel of a), but this locking could not explain their distance tuning (light green, 17.1% of the cells, n = 7 neurons) – because of two reasons: (1) their click-rate as a function of interbat distance (panel a, top) was not significantly correlated with their distance neural tuning (panel a, middle; correlations shown in panel b); or: (2) the click-triggered locking exhibited an opposite effect from the distance modulation, e.g. cells that had significant positive correlation between click-rate and firing rate but had significant suppression of firing in their click-triggered response (e.g. cell 51 in panel a); or conversely, they had significant negative correlation between click-rate and firing rate but enhancement of firing in their click-triggered response. (iii) neurons whose significant locking to echolocation-clicks might potentially explain their distance tuning (white, 12.2% of the cells, n = 5 neurons; e.g. cell 37 in panel a [significant negative correlation and negative click-triggered response (suppression)]). overall, the tuning of 87.8% of the 1d distance cells (sum of the two green areas) could not be explained by simple sensory or motor responses to clicks. d, distribution of the absolute time-difference between the peak click-rate (peak of the blue curves in a) and the peak firing rate during cross-over (peak of the pink curves in a; n = 41 cells × directions). time differences were computed based on tuning-curves that were calculated in time-to-cross-over rather than distance (these two variable are highly correlated, see extended data fig. 4d, e, and thus yield very similar curves). note that for many cells the peak in firing rate and the peak in click-rate could be more than 0.5 s apart – which is much more than expected from a pure sensory or motor responses in the brain. further, we note that pure sensory or motor responses also could not explain the complex 2d characteristics of the distance by position tuning shown in figs. 2 and 4. the rationale for this is as follows: since the increase in click-rate during cross-overs is very robust and occurs at all positions in the tunnel (fig. 1f, extended data fig. 2d), then we expect that if a cell purely responds to clicks, we should see similar firing-rate modulation (as a function of distance) at all positions. however, we observed many neurons with distance modulations that were restricted to specific positions in the tunnel (fig. 3a, d, f), as well as non-separable representation of position by distance (shown in fig. 5a–g) – which rules out this possibility. e, distance modulation of firing rate by attention. shown are five examples of 1d distance cells, plotted separately for high click-rate flights (purple) versus low click-rate flights (pink). four leftmost cells are the same neurons as in main fig. 2e, and are significantly modulated by attention. rightmost cell (cell 37) is one of the five neurons that were found to be potentially explained by sensory or motor response to clicks (according to the controls in panels a–d) – yet, it was not significantly modulated here by attention. for each cell: top, echolocation behaviour: mean click-rate as a function of interbat distance, for high click-rate flights (purple) and low click-rate flights (pink) (see methods for flight bisection into these two groups of flights). middle, neuronal responses: distance tuning-curves for high click-rate flights and low click-rate flights. bottom left: δ mean firing rate (high–low) for the actual data (red line) and for 10,000 random permutations of the flights (grey histogram); firing rates (fr) were computed in a ±10-m window (see methods). bottom right: δ peak firing rate (high–low) for the actual data (red line) and for random permutations (grey histogram). note that although the differences in click-rate between high- and low-attention flights were relatively small (top row), the differences in firing rate were prominent in some neurons (middle row), and were highly significant (bottom row; p < 0.05 in all tests for the three leftmost cells) – and were also significant across the population (fig. 2f, g). finally, we note that the fact that the distance tuning could not be explained by simple responses to clicks (see panels a–d), suggests that the modulation that we found by high/low click-rate (fig. 2e–g and panel e here) reflects modulation by attention or other high cognitive variable.a, no tuning to the position of the other bat. (i) scatter plot of surprise values (–log10(p-value)) for the spatial information (si) of the tuning-curves during cross-over flights for the self-position (y-axis; see the left tuning curves in a(iii)) versus position of the other bat (x-axis; see the right tuning curves in a(iii); these two examples are marked on the scatter-plot by two black dots). the position tuning for self was much more prominent that the position tuning for the other bat (paired t-test: p = 2.04×10–198, n = 660 pyramidal cells × directions [all the valid pyramidal cells that had ≥ 30 spikes during cross-over]). p-values were computed compared to 1,000 shuffles. for display purposes only, the points with the maximum value in the scatter (surprise = 3) were slightly jittered positively in x or y, respectively. the high surprise values on the y-axis correspond to the very prominent self place-tuning in the hippocampus. by contrast, we note that only 1.2% of the cells were significantly modulated and stable to the other bat’s position (n = 8 neurons, marked in red; see also methods) – which is not different than expected by chance given our 99% significance threshold (binomial test for population-wide significance [with expected p0 = 0.01]: p = 0.34). we note that none of these 8 cells (one of which is cell 29 in panel b) showed convincing representation of the position of the other bat during cross-overs. (ii) distribution of surprise differences: –log10(pself) – (–log10(pother)); i.e. distribution of the y–x differences for each point in a(i) (n = 660 pyramidal cells × directions). (iii) example cells for this analysis: tuning curve to self-position (left) and to the other bat’s position (right) during cross-overs. surprise values in panels a(i) and a(ii) were computed based on these two types of position tuning curves. note the clear tuning to self-position (place-tuning) and the lack of such tuning to the other bat’s position in these two cells. b–f, to further explore the possibility that during cross-overs, ca1 neurons represent the position of the other bat, we replotted the data as follows. we constructed a 2d firing-rate map as a function of the self-position on the y-axis versus the position of the other bat on the x-axis (central maps for each cell in panel b, using the same procedure as we did for the 2d distance by position maps). on such 2d maps, a pure place cell would show horizontal stripes with high firing at the positions of its place fields (stripes at angle 0°); a cell that purely represents the other bat’s position would show vertical stripes – at the positions where the cell is responding to the other bat (stripes at 90°); while a 1d distance cell that responds at a specific distance from the other bat would show diagonal stripes (at 45°) because the interbat distance is by definition the difference between the y and the x axes in this panel. since all three predictions yield stripes in these 2d firing rate maps, we computed the autocorrelations of these maps (2d shifted pearson correlations map70,71; see panel b: 2d auto-correlation) – which are known to emphasize stripes. we then computed for each cell the mean correlation value in the relevant three bands – horizontal: 0°, vertical: 90° and diagonal: 45°, within the 2d autocorrelation map. each band had a width of 7 bins. since the diagonal of the 2d autocorrelation map is longer than its horizontal or vertical dimensions, we cropped the diagonal-band from both ends, such that its length was equal to the mean length of the vertical and horizontal bands (see panel c, cartoon). for all bands we excluded the central circle in the 2d autocorrelation map (radius of 3.5 bins) – to avoid the dominant central peak in the autocorrelation. a place cell would have high average correlation in the horizontal band at 0° (denoted m0); a cell representing the other bat’s position would have high average correlation in the vertical band at 90° (m90); and a 1d distance cell would have a high average correlation in the diagonal band at 45° (m45). b, four example cells (for each cell the data are shown only during cross-over flights): left, the standard position-by-distance 2d firing rate map – which shows the firing rate as a function of position (y-axis) and interbat distance (x-axis); and plotted also is the distance tuning curve (top). centre, position-by-position 2d firing rate map – which shows the firing-rate as a function of self-position (y-axis) and other bat’s position (x-axis); the magenta-coloured tuning curves depict the tuning-curve for the self-position (right) and the tuning-curve for the other bat’s position (top). both of these firing-rate maps are colour-coded from zero (blue) to maximal firing rate (red; value indicated). right, 2d autocorrelation map (shifted pearson correlations) of the position-by-position firing rate map of self-position versus other bat’s position (i.e. autocorrelation of the map in the centre; colour-coded from minimum to maximum = 1). values of m0, m45, m90 for these four neurons are indicated. as expected, place cells (e.g. cells 145 and 136) showed prominent horizontal stripes in their 2d autocorrelation-maps, resulting in high correlation values in the horizontal band (high m0; see panel c for cartoon of computation); 1d distance cells (e.g. cell 51) showed high correlation in the diagonal band (high m45); and cells representing the other bat’s position (cell 29) showed high correlations in the vertical band (high m90). we note that cell 29 had one of the highest values of m90 compared to its other 2 values – i.e. it was a potential candidate for a neuron representing the other bat’s position – and yet its 2d map and 2d autocorrelation do not show true vertical stripes. in fact, we did not find a single neuron that was convincingly tuned to the position of the other bat in this experiment (see also population analyses in panels a, d, e, f) – but rather the dominant signals were the interbat distance and the self-position. we believe that this is probably because: (i) the distance to the other bat is directly available via the bat’s sonar sensory system2,39; (ii) in this collision-avoidance experiment it was more behaviourally-important to represent the distance to the other bat (m45), in order to avoid collisions – rather than representing the position of the other bat. c, schematic showing the 3 rectangular bands in which we computed m0, m45 and m90 from the 2d autocorrelations (values of m0, m45 and m90 are indicated for each cell in panel b): for each band we computed the mean correlation over all of its bins, while excluding the central circle (white; radius 3.5 bins). d, mean 2d autocorrelation maps, computed only over cells with enough behavioural coverage in the 2d map of self-position versus other bat position (cells for which ≥75% of the full 2d behavioural map was covered): these mean 2d autocorrelations are plotted separately for pyramidal cells (n = 577 cells × directions), interneurons (n = 35 cells × directions), place cells (n = 519 cells × directions), and 1d distance cells (n = 125 cells × directions). we excluded from the display the central circle (radius 3.5 bins), which is the same circle that we removed for the calculation of m0, m45 and m90 above; we also excluded here bins which comprised < 10 neurons. e, distribution of differences between m0 and m90, for the same groups of cells as in panel d. note that for most cells, m0 was higher than m90 (p-values of t-tests are shown) – indicating stronger representation of self-position as compared to the representation of the other bat’s position. f, distribution of differences between m45 and m90, for the same groups of cells as in d. note that in all groups, m45 was higher than m90 for most cells (p-values of t-tests are shown) – indicating stronger representation of interbat distance as compared to the other bat’s position. specifically, we note that for the group of 1d distance cells (rightmost panel), which are of particular interest, the m45 values were significantly higher than m90 (t-test: p = 1.68 × 10–17) – suggesting that the 1d distance tuning seen in the data could not be explained via a representation of the other bat’s position.all the data included in this figure are taken from bat 30, which performed also tracking behaviour. a, an example of a 7.2-min epoch from one session, which included both solo, cross-over, and tracking behaviours. plotted are the positions of the two bats – the recorded bat in blue line and the other bat in orange line. cross-over events are marked with pink circles, and cross-over flights (window of ±40 m of interbat distance around the cross-over event) are marked with pink rectangles. solo flights are marked with grey rectangles. tracking behaviours are marked with 2 different aquamarine rectangles: (i) following: when the recorded bat was behind the other bat, with an interbat distance between −20 m to 0 m. (ii) leading: when the recorded bat was ahead of the other bat, with interbat distance between 0 m to 20 m. b, population average of the click-rate during cross-overs (pink), tracking (blue), and solo (black); shaded colours and black error-bar indicate mean ± s.d (n = 426 cross-over flights, n = 602 tracking flights, and n = 64,454 solo time bins). note that during tracking, the bats did not increase their click-rate as much as during cross-over – suggesting that tracking behaviour is less attentionally-demanding than collision-avoidance behaviour during cross-overs. c, three example neurons. top, 1d distance tuning-curve during tracking (dark blue) and during cross-over (pink). bottom left, spike raster during solo flights (black dots), showing position (y-axis) versus time (x-axis). central large panel, position of the recorded bat (y-axis) and interbat distance (x-axis) during tracking (grey) with spikes overlaid (dark blue). right two panels, position tuning curves (place-tuning) of the cell during solo flights (black), during following (left; aquamarine line) or during leading (right; light aquamarine line), and during cross-over flights (pink; computed over −20 to 0 m or 0 to 20 m, which is the same distance-range as following and leading). note that in all three examples, the position tuning-curves during tracking (right) were very similar to the position tuning-curves during solo flights; and that the distance tuning-curves during tracking (top: dark blue line) were rather flat for two of these three neurons, and were very different from the distance tuning-curve during cross-overs (top: pink line). d–g, population summaries of place cells that were recorded in bat 30 in the tracking condition (n = 91 place cells × directions in total). d, in all panels: the y-axis is the pearson correlations between position tuning during cross-overs and during solo flights, and the x-axis is the pearson correlations between position tuning during tracking flights and solo flights. histograms show marginal distributions. left – all tracking data (wilcoxon rank sum test of y versus x for the dots, p = 3.14 × 10–13). middle – following (wilcoxon rank sum test, p = 7.60 × 10−4). right – leading (wilcoxon rank sum test, p = 2.59 × 10–11). in all panels, the position-tuning correlations between tracking and solo were high, and significantly higher than the position-tuning correlations between cross-over and solo: this suggests that the solo position-tuning of place cells was not strongly altered during tracking behaviours, and thus the position tuning remained essentially the same during tracking and solo. e, comparing following and leading. shown is the pearson correlation between position tuning during leading and during solo flights (y-axis) versus the pearson correlation between following and solo flights (x-axis). panel plotted as in d. note the high correlations between both following and solo, and leading and solo: these correlations were not significantly different from each other, i.e. between the following and leading conditions (wilcoxon rank sum test, p = 0.094). f, similar to d, but with normalized mean squared difference (msd) instead of the pearson correlation. msd was defined as: \({\rm{m}}{\rm{s}}{\rm{d}}=\langle {({f}_{1}-{f}_{2})}^{2}\rangle /(max({f}_{1},{f}_{2})-min({f}_{1},{f}_{2}))\), where f1 and f2 are the two position tuning-curves; the numerator thus denotes the mean of the sum of squared differences between the position tuning-curves (n = 91 place cells × directions). left – all tracking data (wilcoxon rank sum test, p = 1.36 × 10−7). middle – following (wilcoxon rank sum test, p = 9.12 × 10−4). right – leading (wilcoxon rank sum test, p = 2.73 × 10−7). in all panels, the position-tuning msd between tracking and solo was significantly lower than the position-tuning msd between cross-over and solo: as in panel d, this suggests that the position tuning remained essentially the same during tracking and solo. g, msd between position tuning during following and solo flights (x-axis) and between leading and solo flights (y-axis). panels plotted as in f. note that msd values between solo and following and between solo and leading are both low – indicating similar tuning – and are not significantly different between following and leading (wilcoxon rank sum test, p = 0.78). h–i, population summaries of significant 1d distance cells (defined by significant modulation during cross-overs) recorded in bat 30 in the tracking condition (n = 27 cells × directions). h, pearson correlations between the position tuning-curve during tracking and during solo flights (x-axis) versus the pearson correlations between interbat distance tuning-curves during tracking and during cross-over flights (y-axis) (wilcoxon rank sum test, p = 1.20×10−7). this scatter-plot suggests that cells which are distance-tuned during cross-over flights do not preserve their distance tuning during tracking (note the large spread of correlations along the y-axis) – while they do preserve their solo position tuning during tracking (note the high correlations in the x-axis). i, normalized msd (see panel f for details), computed between the position tuning-curves during tracking and during solo flights (x-axis) versus the normalized msd computed between the interbat distance tuning-curves during tracking and during cross-overs flights (y-axis) (wilcoxon rank sum test, p = 1.46 × 10−8). as in panel h, this scatter-plot suggests that during tracking, 1d distance cells do not maintain their distance tuning as in cross-overs – but do preserve their position tuning during tracking as in solo flights. moreover, when analysing the distance tuning during tracking in the same way as for the cross-over data, we found a low percentage of cells that had significant distance tuning during tracking: only 5.0% of the pyramidal neurons (n = 5 cells × directions) and 16.1% of the interneurons (n = 5 cells × directions) were significantly modulated by distance during tracking.a, two example cells recorded in the switching-partner sessions (methods). for each cell: shown are session a with the usual partner (left) and session b with an alternative partner (right); the recorded bat was trained with both bats before the recordings. both sessions were recorded in the same day, with a break between them for rest. spike sorting was done across both sessions together, and cells were verified to be stable throughout both sessions. data plotted as in main fig. 2a. these two cells exhibited rather similar 2d distance-by-position tunings in both sessions – suggesting that the distance coding is invariant to the identity of the other bat. b–c, comparing session a and session b (for all 4 panels we show all the n = 27 cells × directions which were significant 1d or 2d distance cells). b, left, correlations of the 1d distance tuning-curves between session a and session b, computed within-cells (pink) and across different cells (shuffles, grey) (kolmogorov-smirnov test of pink versus grey: p = 6.09 × 10−3, wilcoxon rank sum test: p = 3.02 × 10−3). right, correlations of the 2d distance by position firing-maps between session a and session b (kolmogorov-smirnov test: p = 2.48 × 10–14, wilcoxon rank sum test: p = 1.45 × 10–14). c, similar to panel b, but with normalized mean squared difference (msd) instead of the pearson correlation. msd was defined as: \({\rm{m}}{\rm{s}}{\rm{d}}=\langle {({f}_{1}-{f}_{2})}^{2}\rangle /(max({f}_{1},{f}_{2})-min({f}_{1},{f}_{2}))\), where f1 and f2 are the two tuning-curves. left, msd of the 1d distance tuning-curves between session a and session b (kolmogorov-smirnov test of pink versus grey: p = 7.08 × 10−4, wilcoxon rank sum test: p = 2.99 × 10−5). right, msd of the 2d distance by position firing-maps between session a and session b (kolmogorov-smirnov test: p = 1.75 × 10−8, wilcoxon rank sum test: p = 3.15 × 10–9). the histograms in panels b–c show that the correlations between sessions a and b were higher than chance (shuffle) and the msd values were lower than chance (shuffle). taken together, these results indicate that the distance code was largely invariant to the other bat’s identity, suggesting that the distance code might be related to collision-avoidance rather than to a social representation – likely because when flying at high speed, the bats care mostly about collision-avoidance, and less about the identity of the other bat they are avoiding collision with. future experiments could potentially use drones – flying inanimate objects – to further test whether these neurons carry a social signal.a, additional examples of 6 place cells with significant distance modulation within place fields. plotted as in fig. 3a. note that cell 287 has 2 fields: one field exhibits enhancement during cross-over while the other exhibits suppression – therefore, the two fields cancel each other in the overall 1d distance tuning of this cell, resulting in non-significant distance tuning (pink top tuning-curve). this example emphasizes the need to compute distance tuning-curves within place fields, as well as to perform 2d analysis on the entire 2d map. b, population summary: position of the place fields (mean position of the place field edges; y-axis) versus the interbat distance of significantly distance-modulated bins (x-axis); plotted are the significant enhancement bins (left) and significant suppression bins (right); colour of dots depicts the z-score of the distance tuning curve. c, distance bins, as in fig. 3e, plotted here only for significant place-fields (without the interfields that were included in fig. 3e). top: significantly enhanced fields, sorted by the peak-distance of the distance tuning-curve. bottom: significantly suppressed fields, sorted by the trough-distance of the distance tuning-curve. place fields with compound modulation (exhibiting both enhancement and suppression) appear in both the top panel and bottom panel. d, scatter-plot of the mean firing rate within the significant distance bins during cross-overs (y-axis) versus the mean firing rate estimated from the solo-projected on cross-over shuffle for the same distance bins during solo (x-axis). by definition, enhancement bins (green) should be above the diagonal identity line (black) and suppression bins (brown) should be below the identity line – however, we note that the dots here were far away from the identity line, reflecting an average 5-fold increase of firing rate for enhancement responses, and 10-fold decrease for suppression responses (the ratio between the firing rates was 5.26 ± 9.71 for enhancement bins (mean ± s.d.; \(firing\;rate\;during\;cross\;over/firing\;rate\;during\;solo\)) and 9.76 ± 7.82 for suppression bins (mean ± s.d; \(firing\;rate\;during\;solo/firing\;rate\;during\;cross\;over\)). inset, zoom-in on 0 to 7 hz on both axes: note that even at low firing rates the differences in firing rates between solo and cross-over were highly prominent, i.e., the dots were very far from the diagonal identity line. e, tuning curves of switch times within place-fields (normalized min-to-max; top, rise-time for enhancement tuning, n = 143 place fields; bottom, fall-time for suppression tuning, n = 62 place fields). the x-axis shows the time from crossing 50% of the shuffles. black curve, median response across all place-fields. note that most of the tuning curves reached their maximum (or minimum) response within ~300 ms, and some tuning-curves exhibited a rise-time as fast as 100 ms, or even faster.a, additional examples of three neurons with significant enhancement within ‘interfields’; plotted as in fig. 3d. vertical lines to the left of the central panel mark the place fields (black) and the interfield area that we analysed here (peach-coloured). black arrows inside the central raw data panels indicate spikes contributing to the distance tuning within the interfields. some of these interfield regions were areas in the tunnel where during solo-flights the neuron showed almost no activity (see cell 269 here, and fig. 3d cell 235: note that in the solo-raster [right, black dots] there are almost no spikes within the interfield area). in other neurons, these inter-field regions showed some low firing rate during solo, albeit too low to be detected as a place field (cells 312 and 86 here, and fig. 3d cell 221). this suggests that the sub-threshold position-inputs that underlie these sub-threshold place fields28, might be enhanced by incoming distance inputs and thus rendered supra-threshold – resulting in distance by position increase in firing rate (see also extended data fig. 16). b, population summary: position of the interfields (mean position of the interfield edges; y-axis) versus the interbat distance of significantly distance-modulated bins (x-axis); colour of dots depicts the z-score of the distance tuning curve. c, distance bins, as in main fig. 3e, plotted here only for interfields; sorted by the peak-distance of the distance tuning curves. note that the significantly tuned interfields show only enhancement; we could not detect suppression because, by definition, interfields have very low firing rate to begin with. d, scatter-plot of the firing rate within the significant distance bins during cross-overs (y-axis) versus the firing rate estimated from the solo-projected on cross-over shuffle for the same distance bins during solo (x-axis). by definition, enhancement bins (green) should be above the diagonal identity line (black) – however, we note that the dots here were far from the identity line, and the ratio between the firing rates was 18.50 ± 31.79 (mean ± s.d.; \(firing\;rate\;during\;cross\;over/firing\;rate\;during\;solo\)). inset, zoom-in on 0 to 3 hz on both axes: note that even at very low firing rates, the differences in firing rates between solo and cross-over were highly prominent, i.e., the dots were very far from the diagonal identity line. e, additional examples of four neurons with 2d patches showing significant enhancement or suppression within ‘interfield’ areas (methods); plotted as in fig. 3f. cells 312 and 269 are the same as in panel a; note that the 2d patch analysis captures well the extra firing within the cells’ interfields (compare to the raw data in a). cell 135 is an example of a neuron without place tuning (it did not pass the criterion for significant place cells during solo) – and yet it showed localized distance-by-position modulation, which was detected by the 2d patch analysis. finally, we note that cell 81 shows a significant-enhancement 2d patch that occurred outside of place fields (see the green outline) – and there was also a slight reduction in firing rate within the main place field, which was too mild to be detected as significant. f, position and interbat distance of the centroids (centre-of-mass) of all the significant 2d patches (direction1: 134 enhancement patches, 88 suppression patches; direction2: 131 enhancement patches, 103 suppression patches).a, b, confusion matrices for three example sessions (from two different bats), showing decoding of position (a) and decoding of distance (b). plotted as in fig. 4f. bin size, 3×3 metres. the number of simultaneously-recorded cells is shown. a diagonal structure in these matrixes indicates good decoding. c–d, higher echolocation click-rate (heightened attention) improves the distance decoding-error. c, decoding error as a function of attention (same data as in fig. 4g, h, but here plotted as violin-plots), for one example session (left; n = 146, 134, 146, 151 decoding time-windows for q1-q4, respectively), and for all the 9 sessions in which we had audio recordings and ≥10 cells (right; n = 998, 1051, 1074, 1063 decoding time-windows for q1-q4, respectively). white circle, median; thick grey line, 25–75 percentiles. note the decoding error decreased as the click-rate increased (q4: maximal click-rate, i.e. maximal attention). kruskal-wallis test:* p < 0.05, ** p < 0.01, *** p < 0.001, **** p < 0.0001; no stars means non-significant test. exact p-values for left panel: q1 and q2, p = 0.14; q1 and q3, p = 3.71 × 10−3; q1 and q4, p = 1.23 × 10−5; q2 and q3, p = 0.64; q2 and q4, p = 0.07; q3 and q4, p = 0.55. exact p-values for right panel: q1 and q2, p = 0.44; q1 and q3, p = 0.04; q1 and q4, p = 4.51 × 10–9; q2 and q3, p = 0.62; q2 and q4, p = 3.36 × 10−6; q3 and q4, p=7.69×10−4. exact p values for anova in main fig. 4g: q1 and q2, p=0.11; q1 and q3, p = 8.80 × 10−3; q1 and q4, p = 3.38 × 10−5; q2 and q3, p = 0.83; q2 and q4, p = 0.13; q3 and q4, p=0.53. exact p values for anova in main fig. 4h: q1 and q2, p = 0.23; q1 and q3, p = 0.02; q1 and q4, p = 4.32 × 10–9; q2 and q3, p = 0.75; q2 and q4, p = 2.20 × 10−5; q3 and q4, p = 1.52 × 10−3. d, instantaneous click-rate analysis: the instantaneous click-rate was calculated for each of the decoding time bins (1 s), at interbat distances of –15 m to 0 m (where the increases in click-rate are most prominent). bottom: probability matrix for distance decoding error (y-axis) across different instantaneous click-rates (x-axis); each column of the matrix is a probability distribution, i.e. each column sums to 1. the matrix was smoothed using a 2d gaussian with σ = 1.5 bins. top: sparsity for the different click-rate columns of the probability matrix (\({\rm{sparsity}}={\left\langle {r}_{i}\right\rangle }^{2}/\left\langle {r}_{i}^{2}\right\rangle \), where ri are the distance decoding-error values in each bin of each column; higher sparsity denotes a more uniform distribution of decoding-errors within the column). note that as attention increased (higher click-rate), both the probability of decoding-errors became less uniformly distributed (sparsity decreased, see magenta curve) – and also the prevalence of small errors became much higher (note the white colour at the bottom-right corner of the matrix). in other words, the distance coding became better for high click-rate (high attention). this analysis is complementary to fig. 4g, h and to panel c in the current figure, where click-rate was calculated per-flight – here, by contrast, we computed the instantaneous click-rate, using finer bins of click-rate. finally, we note that our simultaneous-decoding analysis of distance and position worked surprisingly well, but not as well as reported in the rodent literature. this difference might stem from the following: (i) we conducted simultaneous decoding of two variables, while most studies decode only one variable, namely position. (ii) we recorded in freely flying bats, therefore we were limited by the number of simultaneously-recorded cells per day (13.19 ± 3.08 neurons per day, mean ± s.d.). (iii) we used here a relatively long integration time window of 1 s (methods), both to account for the low number of simultaneously-recorded cells, and to allow accumulation of enough spikes. however, this long integration time came with a cost: during this 1-second window the bat progressed 7 m in the position axis and 14 m in the distance axis, potentially yielding higher errors.a, three example neurons (different rows) for svd analysis (the bottom two cells were also plotted in fig. 5e). for each cell: left, 2d firing rate map of position (y-axis) by interbat distance (x-axis), cropped, filled and mean-subtracted to create a full rectangle, as required by the svd analysis (methods). rightmost three panels show the first three matrices reconstructed from the svd analysis (three first dimensions; see methods for more details). for each neuron (row), all four maps were set to have the same colour limits (set as the overall minimum and maximum values across the four matrices for that neuron). the singular value of each dimension (s1, s2 or s3) was normalized by the sum of all singular values, and is written above each matrix. for separable cells (such as cell 117), the first dimension captures quite well the 2d firing rate map of the cell, yielding a high singular value, while the second and third dimensions have very low singular values, reflecting their negligible contribution to the reconstructed map (note the nearly-uniform deep-blue colour of the maps for the second and third dimensions in cell 117). by contrast, for non-separable cells (such as cells 325 and 235), the first dimension does not capture well the 2d firing rate map, and therefore adding more dimensions is required: indeed the singular values of the second and sometimes even the third dimensions are not negligible (note the non-deep-blue colour of the maps for these dimensions in cells 325 and 235). b, c, example of svd analysis for cell 235 (this cell is also shown in fig. 5e right, and in panel a above). b, top, 1d distance tuning-curve. middle, 2d firing rate map of position (y-axis) by interbat distance (x-axis), cropped and filled to create a full rectangle for the svd analysis. bottom, histograms of non-separability indices λ (left) and α (right), calculated for shuffle firing-rate maps (grey, see shuffle examples in panel c, bottom); the real values of λ and α for the cell are indicated by a vertical red line – these values were much higher than for the shuffles, indicating significant non-separability for this cell (methods). c, top, three examples of 2d distance by position firing-rate maps for solo projected on cross-over shuffles – for the cell in panel b (see extended data fig. 5 and methods for the process of generating these types of shuffle matrices). bottom, same shuffle matrices after multiplying them by the 1d distance tuning of the cell (i.e. by the top pink curve in b). these maps at the bottom (‘multiplied maps’) were the maps used for computing the λ and α values for the shuffle distribution. note that these shuffle maps are based on the exact same behavioural data, the same spike statistics and the same 1d distance tuning as in the real data – but these shuffle maps are almost separable. importantly we note that multiplying by the 1d distance tuning did not increase the non-separability, because multiplication is separable by definition – and therefore any non-separability that we would find in these shuffle maps must arise from either the non-uniform coverage of bat-behaviour or from the noisy spiking of the neurons. the λ and α values written above the maps indicate the non-separability indices of these shuffle maps (these are 3 of the 10,000 shuffle values per neuron that are plotted in the grey histograms in b-bottom). d, e, cross-validated svd. d, three example neurons (same neurons as in panel a). top left, firing rate map of position (y-axis) by interbat distance (x-axis) during cross-over, plotted as in panel a. top right, median map for solo projected on cross-over shuffles (median of all the 10,000 shuffle maps, examples of which are shown in the top row in c). bottom, train errors (blue) and test errors (red) as a function of cumulative dimension, using the cross-validated svd analysis for the maps above (mse: mean squared error; see methods). the dimensionality of each map equals the dimension at which the test error curve (red) reaches its minimum. then, to compute the effective dimensionality of the cell (‘projection dimension’, denoted in the title of each cell), we projected the median solo singular vectors on the cross-over singular vectors. this procedure captures the dimension of the cross-over maps, after removing any non-separability that might arise from a non-uniform behaviour or noisy spiking statistics (methods). cell 117 is a separable cell (i.e., it can be described by multiplication of distance tuning × position tuning), and accordingly its projection dimension is < 1. cells 325 and 235 are significantly non-separable cells with projection dimension ≥ 1. e, scatter plot of projection dimension computed in the cross-validated svd analysis, plotted versus λ in the left panel – for all the distance cells that were valid for this analysis (pearson correlations: all cells: r = 0.50, p = 6.96 × 10–18, n = 262 cells × directions; non-significant cells [grey]: r = 0.43, p = 7.16 × 10–10, n = 189 cells × directions; significant non-separable cells [red]: r = 0.48, p = 1.83×10−5, n = 73 cells × directions); or plotted versus α in the right panel (pearson correlations: all cells: r = 0.47, p = 6.61 × 10–16, n = 262 cells × directions; non-significant cells [grey]: r = 0.38, p = 5.53 × 10−8, n = 189 cells × directions; significant non-separable cells [red]: r = 0.45, p = 5.31 × 10−5, n = 73 cells × directions). importantly, we also verified that the non-separability of the cells could not be explained by the quality of the spike-sorting: we found no correlation between the isolation-distance of the cells – a common metric used for quantifying spike-sorting quality72 – and the non-separability indices of the svd analysis (λ: pearson r = 0.09, p = 0.15, n = 262 cells × directions; α: pearson r = 0.08, p = 0.18, n = 262 cells × directions). likewise, we found no correlation between the isolation-distance of the cell and the distance tuning correlation between pairs of place fields of the same neuron (as in fig. 5b–d; pearson r = −0.05, p = 0.48, n = 170 place-field pairs). further, the non-separability could not be explained by non-homogeneities in click-rate or speed – because the click-rate modulation profile was uniform along the tunnel (fig. 1f, extended data fig. 2d), and the speed profile was also uniform along the tunnel (extended data fig. 6c, bottom). thus, the non-separable coding is a genuine phenomenon.a, fifteen examples of simulated cells, showing 2d maps of distance by position for 3 different underlying position tunings (3 rows) and 5 different levels of non-separability (5 columns). for each position tuning (each row), we created different distance modulations using 5 values of the non-separability parameter, xsep (methods): low xsep generates separable 2d maps, while larger xsep generates non-separable maps with higher values of non-separability indices λ and α, computed as in the svd analysis; xsep, λ, α are indicated for each map. b–e, results of the maximum likelihood decoder. b, d, mean distance decoding error (left) and catastrophic distance decoding error (right, 99% percentile of the errors), plotted in log-scale as a function of the interbat distance, separately for simulated populations of cells with different non-separability values (α values used in panel b, and xsep values used in panel d). note that as the population of cells becomes more non-separable (higher α or higher xsep) the decoding error decreases. c, e, mean distance decoding error (left, colour-coded) and catastrophic distance decoding error (right) as a function of the number of neurons used for decoding and the non-separability index (α values used in panel c, and xsep values used in panel e). note that in these four matrices, increasing the non-separability has a similar effect on error-reduction as adding more neurons. f, g, similar plots to main fig. 5h, i, but here we used population vector decoding instead of maximum likelihood decoding. both types of decoders yielded very similar results: as the population of cells became more non-separable, the decoding error decreased.cartoon of a ca1 neuron. multiple independent position inputs (grey) arrive from neurons with single place fields in hippocampal area ca3, as was suggested in ref. 14, and impinge on different dendrites of a ca1 neuron – forming a place cell with multiple place fields. these position inputs could also originate from medial entorhinal cortex (mec)73. in addition, we propose that independent diverse distance inputs (pink) arrive to the dendrites of the same ca1 neuron. the result of such convergence between independent distance and position inputs can create a non-separable ca1 neuron with multiple place fields, each with a different distance tuning in each place-field – as we observed in many neurons in our data (fig. 3a, fig. 5a–d). it can also create separable neurons (see below). several comments are noteworthy here. (1) first, the distance inputs could arrive possibly from lateral entorhinal cortex, lec, where egocentric coding was reported20, or from the subiculum via the medial entorhinal cortex (mec)18,21,23. these lec/mec inputs might activate pyramidal ca1 neurons either directly, or disynaptically through ca1 interneurons74. we note that the distance information can arrive to lec/mec from either visual areas (as these bats are highly-visual29), or it can reflect echolocation-based sensory information about the distance from the other bat75,76. an alternative model posits that since mec and lec inputs converge anatomically already in ca3, upstream of ca177, it is also possible that the distance by position tuning might be found already in ca3 – and is inherited from ca3 by the ca1 neurons. both options could explain the non-separability of the 2d distance-by-position maps found in ca1. future experiments will be needed in order to test these possibilities. (2) second, this schematic wiring-diagram suggests that not only a ca1 neuron as a whole can be conjunctively tuned to distance by position, but also that each of its single dendrites might be conjunctively tuned to an independent combination of distance by position. in other words, each dendrite may serve as a complex processing-stage – a possibility that is supported by the literature on dendritic computations78,79,80,81, but will need to be tested directly in future experiments. consistent with this, we found that most place-field pairs within the same cell in the data exhibited low correlations between their distance tunings; only a minority showed high positive correlations, which may reflect a common distance input to both fields, i.e. to both dendrites (fig. 5b, small over-representation of positive high correlations). to account for this possibility, the wiring diagram here shows also that two dendrites of the same neuron can sometimes receive distance input from the same neuron in lec or mec (see distance input to dendrites no. 1 and 2 in the schematic). an alternative explanation for this minority of cells with high correlations (seen in fig. 5b) might be that the lec or mec itself carries distance by position information; however, the position information in lec was reported to be very weak82, and distance tuning per se was not reported to date in mec – so this option seems less likely. therefore, we believe that our schematic wiring diagram is more probable. (3) third, the proposed schematic model could also explain how sub-threshold position fields, which are not defined as place fields, are enhanced during cross-overs (fig. 3d, extended data fig. 12: distance tuning inside interfields): this can occur via summation of a sub-threshold position input and sub-threshold distance input, which together cross the firing-threshold. (4) fourth and finally, we note that in this model we posit also external inputs that carry attention, relevance, or context signals (see rectangle on the right). these inputs could explain, for example, why distance tuning is observed during cross-overs, when it is highly relevant, but not during tracking (extended data fig. 9). these hypothesized attention / relevance / context inputs may arrive directly to ca1, or via lec or mec – both options may explain the attentional modulation of the 2d distance-by-position coding that we observed in ca1.open access this article is licensed under a creative commons attribution 4.0 international license, which permits use, sharing, adaptation, distribution and reproduction in any medium or format, as long as you give appropriate credit to the original author(s) and the source, provide a link to the creative commons license, and indicate if changes were made. the images or other third party material in this article are included in the article’s creative commons license, unless indicated otherwise in a credit line to the material. if material is not included in the article’s creative commons license and your intended use is not permitted by statutory regulation or exceeds the permitted use, you will need to obtain permission directly from the copyright holder. to view a copy of this license, visit http://creativecommons.org/licenses/by/4.0/.reprints and permissionssarel, a., palgi, s., blum, d. et al. natural switches in behaviour rapidly modulate hippocampal coding. nature (2022). https://doi.org/10.1038/s41586-022-05112-2download citationreceived: 13 november 2021accepted: 14 july 2022published: 24 august 2022doi: https://doi.org/10.1038/s41586-022-05112-2anyone you share the following link with will be able to read this content:sorry, a shareable link is not currently available for this article. provided by the springer nature sharedit content-sharing initiative by submitting a comment you agree to abide by our terms and community guidelines. if you find something abusive or that does not comply with our terms or guidelines please flag it as inappropriate.